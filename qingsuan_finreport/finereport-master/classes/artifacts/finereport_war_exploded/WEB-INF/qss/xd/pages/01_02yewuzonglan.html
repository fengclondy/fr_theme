<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="${contextPath}/static/img/com/logo.png">
    <link rel="stylesheet" href="${contextPath}/static/asserts/css/normalize.css">
    <link rel="stylesheet" href="${contextPath}/static/css/style.css">
    <link rel="stylesheet" href="${contextPath}/static/css/pageCom.css">
    <style>
        .container > div,
        .top > div,
        .bottom > div {
            flex: 1;
        }

        .top, .bottom {
            display: flex;
        }

        .ec003 header{
            text-align: center;
        }
    </style>
</head>
<body id="01_02yewuzonglan" data-title="业务总览">
<div class="container">
    <h2 hidden>业务总览</h2>
    <div class="top">
        <div class="top-l">
            <div class="chartBox ec001">
                <div class="chartTitle">
                    <h3>当前竞争力排名</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec001_currentCompetitiveness"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="top-r">
            <div class="chartBox ec002">
                <div class="chartTitle">
                    <h3>竞争力各指标对比</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec002_competitivenessIndicators"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom">
        <div class="bottom-l">
            <div class="chartBox ec003">
                <div class="chartTitle">
                    <h3>市场竞争力趋势</h3>
                </div>
                <div class="chartContent">
                    <header>
                        <div class="inputGroup">
                            <label for="jiaoyishichang">交易市场：</label>
                            <div class="mySelect" id="jiaoyishichang">
                                <div class="myOption selected"><span class="text"></span><span class="icon"></span> </div>
                                <ul class="myOptionBox">
                                	 <li data="" class="myOption selected">全部</li>
                                     ##for(j in jyslist!){
                                    <li id="${j.jysc!}"  class="myOption">${j.jyscmc!}</li>
                                     ##}
                                </ul>
                            </div>
                        </div>
                        <div class="inputGroup">
                            <label for="jingzhenglizhibiao">竞争力指标：</label>
                            <div class="mySelect" id="jingzhenglizhibiao">
                                <div class="myOption selected"><span class="text"></span><span class="icon"></span> </div>
                                <ul class="myOptionBox">
                                	<li class="myOption selected">竞争力</li>
                                    <li class="myOption">经营能力</li>
                                    <li class="myOption">盈利能力</li>
                                    <li class="myOption">发展能力</li>
                                </ul>
                            </div>
                        </div>
                    </header>
                    <div class="chartBody">
                        <div id="ec003_marketCompetitivenessTrend"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-r">
            <div class="chartBox ec004">
                <div class="chartTitle">
                    <h3>关键指标排名</h3>
                </div>
                <div class="chartContent">
                    <header>
                        <div class="btnGroup">
                            <button class="active" id="dkye">贷款余额</button>
                            <button id="fke">放款额</button>
                            <button id="rjfke">日均放款额</button>
                            <button id="snbz">三农比重</button>
                        </div>
                    </header>
                    <div class="chartBody">
                        <div id="ec004_KeyIndexRanking"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="${contextPath}/static/asserts/js/echarts-4.0.js"></script>
<script src="${contextPath}/static/asserts/js/jquery-2.2.4.js"></script>
<script src="${contextPath}/static/js/pageCom.js"></script>
<script src="${contextPath}/static/js/chartsCom.js"></script>
<script>
    var allCharts = [];
    var ec001 = echarts.init($("#ec001_currentCompetitiveness")[0]);
    var ec004 = echarts.init($("#ec004_KeyIndexRanking")[0]);
    var ec002 = echarts.init($("#ec002_competitivenessIndicators")[0]);
    $(function () {
        
        ec001.setOption(opt_bar_horizon);
        ec001.setOption({
            grid: {
                left: "22%",
                right: "16%",
                top: "18%"
            },
            xAxis: {
                type: 'value',
                name: '竞争力'
            },
            yAxis: {
                name: '平台',
                data: ['小贷D', '小贷C', '小贷B', '小贷A', '海尔小额贷款']
            },
            series: [{
                data: [1, 3, 5, 7.2, 10],
                type: 'bar',
                barWidth: "20%"
            }]
        });
        // console.log(ec001.getOption())

        
       
        ec002.setOption(opt_bar_vertical);
   
        ec002.setOption({
            legend: {
                show: true
            },
            grid: {
                left: "10%",
                right: "10%",
                top: "14%"
            },
            xAxis:
                {
                    name: '市场',
                    type: 'category',
                    data: ['小贷D', '小贷C', '小贷B', '小贷A', '海尔小额贷款']
                },
            yAxis: {
                name: '竞争力',
                type: 'value'
            },
            series: [
                {
                    name: '经营能力',
                    type: 'bar',
                    data: [1,2,6,3,4]
                },
                {
                    name: '盈利能力',
                    type: 'bar',
                    data: [1,2,3,4,5]
                },
                {
                    name: '发展能力',
                    type: 'bar',
                    barCategoryGap: '36%',
                    data: [2,4,7,3,6]
                }
            ]
        });


        var ec003 = echarts.init($("#ec003_marketCompetitivenessTrend")[0]);
        ec003.setOption(opt_line);
        ec003.setOption({
            grid: {
                left: "12%",
                right: "12%",
                top: "15%"
            },
            xAxis: {
                name: '月份',
                data: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
            },
            yAxis: {
                name: '竞争力',
            },
            series: [{
                data: [2, 5, 7.2, 4, 10, 7.2, 10, 5, 5, 7.2, 10, 5, 6],
                type: 'line',
                symbol:'circle',
                areaStyle: lineAreaStyle(0)
            }]
        });

       
        ec004.setOption(opt_bar_horizon);
       /*  ec004.setOption({
            grid: {
                left: "20%",
                right: "16%",
                top: "15%"
            },
            xAxis: {
                name: '万',
                type: 'value'
            },
            yAxis: {
                name: '市场',
                type: 'category',
                data: ['小贷D', '小贷C', '小贷B', '小贷A', '海尔小额贷款'],
            },
            series: [{
                data: [1, 3, 5, 7.2, 10],
                type: 'bar',
                barWidth: "60%"
            }]
        });
 */
        //本页所有图表
     allCharts = [ec001, ec002, ec003, ec004];
    

      $("#dkye").click(function(){
    	 getKeyIndByYamount();
     })
      $("#fke").click(function(){
    	 getKeyIndByAmount();
     })
      $("#rjfke").click(function(){
    	  getKeyIndByDayAmount();
     })
      $("#snbz").click(function(){
    	  getKeyIndByThreeRuralIssue();
     })
        	
        
	 init();
    });
    //加载页面时初始化
    function init(){
    	getKeyIndByYamount();
    	getCurrentComRanking();
    	getComparisonOfCompe();
    }
    //根据贷款余额查询关键指数排名
    function getKeyIndByYamount(){
      	 $.post("${contextPath}/qdch/businessOverview/getKeyIndByYeamount",function(data){
      		
      		console.log("----关键指标----",data);
       		var yAxisData=[];
       		var seriesData=[];
       		$.each(data,function(index,item){
       			var name="";
       			var page=parseInt(item.name.length/6);
       			if(item.name.length%6>0){
       				page++;
       			}
       			var preName=item.name;
       			for(var x=1;x<parseInt(page)+1;x++){
       				console.log(preName.substr((x-1)*3,6)+"\n")
       				name+=preName.substr((x-1)*6,6)+"\n";
       			}
       			yAxisData.push(name);
       			seriesData.push(item.value);
       		});
       		
       		 ec004.setOption(opt_bar_horizon);
	       	 ec004.setOption({
	             grid: {
	                 left: "20%",
	                 right: "16%",
	                 top: "15%"
	             },
	             xAxis: {
	                 name: '万',
	                 type: 'value',
	             },
	             yAxis: {
	                 name: '市场',
	                 type: 'category',
	                 data: yAxisData,
	             },
	             series: [{
	                 data: seriesData,
	                 type: 'bar',
	                 barWidth: "20%"
	             }]
	         });

       	});
      }
    //根据放款额查询关键指数排名
    function getKeyIndByAmount(){
      	 $.post("${contextPath}/qdch/businessOverview/getKeyIndByAmount",function(data){
      		
      		console.log("----关键指标----",data);
       		var yAxisData=[];
       		var seriesData=[];
       		$.each(data,function(index,item){
       			var name="";
       			var page=parseInt(item.name.length/6);
       			if(item.name.length%6>0){
       				page++;
       			}
       			var preName=item.name;
       			for(var x=1;x<parseInt(page)+1;x++){
       				console.log(preName.substr((x-1)*3,6)+"\n")
       				name+=preName.substr((x-1)*6,6)+"\n";
       			}
       			yAxisData.push(name);
       			seriesData.push(item.value);
       		});
       		
       		 ec004.setOption(opt_bar_horizon);
	       	 ec004.setOption({
	             grid: {
	                 left: "20%",
	                 right: "16%",
	                 top: "15%"
	             },
	             xAxis: {
	                 name: '万',
	                 type: 'value',
	             },
	             yAxis: {
	                 name: '市场',
	                 type: 'category',
	                 data: yAxisData,
	             },
	             series: [{
	                 data: seriesData,
	                 type: 'bar',
	                 barWidth: "20%"
	             }]
	         });

       	});
      }
    //根据日均放款额查询关键指数排名
    function getKeyIndByDayAmount(){
      	 $.post("${contextPath}/qdch/businessOverview/getKeyIndByDayAmount",function(data){
      		
      		console.log("----关键指标----",data);
       		var yAxisData=[];
       		var seriesData=[];
       		$.each(data,function(index,item){
       			var name="";
       			var page=parseInt(item.name.length/6);
       			if(item.name.length%6>0){
       				page++;
       			}
       			var preName=item.name;
       			for(var x=1;x<parseInt(page)+1;x++){
       				console.log(preName.substr((x-1)*3,6)+"\n")
       				name+=preName.substr((x-1)*6,6)+"\n";
       			}
       			yAxisData.push(name);
       			seriesData.push(item.value);
       		});
       		
       		 ec004.setOption(opt_bar_horizon);
	       	 ec004.setOption({
	             grid: {
	                 left: "20%",
	                 right: "16%",
	                 top: "15%"
	             },
	             xAxis: {
	                 name: '万',
	                 type: 'value',
	             },
	             yAxis: {
	                 name: '市场',
	                 type: 'category',
	                 data: yAxisData,
	             },
	             series: [{
	                 data: seriesData,
	                 type: 'bar',
	                 barWidth: "20%"
	             }]
	         });

       	});
      }
    //获取三农比重的关键指数排名
    function getKeyIndByThreeRuralIssue(){
     	 $.post("${contextPath}/qdch/businessOverview/getKeyIndByThreeRuralIssue",function(data){
     		
     		console.log("----关键指标----",data);
      		var yAxisData=[];
      		var seriesData=[];
      		$.each(data,function(index,item){
      			var name="";
      			var page=parseInt(item.jyscmc.length/6);
      			if(item.jyscmc.length%6>0){
      				page++;
      			}
      			var preName=item.jyscmc;
      			for(var x=1;x<parseInt(page)+1;x++){
      				console.log(preName.substr((x-1)*3,6)+"\n")
      				name+=preName.substr((x-1)*6,6)+"\n";
      			}
      			yAxisData.push(name);
      			seriesData.push(item.nums);
      		});
      		
      		 ec004.setOption(opt_bar_horizon);
	       	 ec004.setOption({
	             grid: {
	                 left: "20%",
	                 right: "16%",
	                 top: "15%"
	             },
	             xAxis: {
	                 name: '三农比重',
	                 type: 'value',
	             },
	             yAxis: {
	                 name: '市场',
	                 type: 'category',
	                 data: yAxisData,
	             },
	             series: [{
	                 data: seriesData,
	                 type: 'bar',
	                 barWidth: "20%"
	             }]
	         });

      	});
     }
    //获取当前竞争力排名
    function getCurrentComRanking(){
     	 $.post("${contextPath}/qdch/businessOverview/getCurrentComRanking",function(data){
     		
     		console.log("----关键指标----",data);
      		var yAxisData=[];
      		var seriesData=[];
      		$.each(data,function(index,item){
      			var name="";
      			var page=parseInt(item.jyscmc.length/6);
      			if(item.jyscmc.length%6>0){
      				page++;
      			}
      			var preName=item.jyscmc;
      			for(var x=1;x<parseInt(page)+1;x++){
      				console.log(preName.substr((x-1)*3,6)+"\n")
      				name+=preName.substr((x-1)*6,6)+"\n";
      			}
      			yAxisData.push(name);
      			seriesData.push(item.jzl);
      		});
      		
      		ec001.setOption(opt_bar_horizon);
            ec001.setOption({
                grid: {
                    left: "22%",
                    right: "16%",
                    top: "18%"
                },
                xAxis: {
                    type: 'value',
                    name: '竞争力'
                },
                yAxis: {
                    name: '平台',
                    data: yAxisData
                },
                series: [{
                    data: seriesData,
                    type: 'bar',
                    barWidth: "20%"
                }]
            });

      	});
     }
  //获取当前竞争力排名
    function getComparisonOfCompe(){
     	 $.post("${contextPath}/qdch/businessOverview/getComparisonOfCompe",function(data){
     		
     		console.log("----关键指标----",data);
      		var yAxisData=[];
      		var seriesData1=[];
      		var seriesData2=[];
      		var seriesData3=[];
      		$.each(data,function(index,item){
      			var name="";
      			var page=parseInt(item.jyscmc.length/6);
      			if(item.jyscmc.length%6>0){
      				page++;
      			}
      			var preName=item.jyscmc;
      			for(var x=1;x<parseInt(page)+1;x++){
      				console.log(preName.substr((x-1)*3,6)+"\n")
      				name+=preName.substr((x-1)*6,6)+"\n";
      			}
      			yAxisData.push(name);
      			seriesData1.push(item.jynl);
      			seriesData2.push(item.ylnl);
      			seriesData3.push(item.fznl);
      		});
      		
      		 ec002.setOption(opt_bar_vertical);
      	   
             ec002.setOption({
                 legend: {
                     show: true
                 },
                 grid: {
                     left: "10%",
                     right: "10%",
                     top: "14%"
                 },
                 xAxis:
                     {
                         name: '市场',
                         type: 'category',
                         data: yAxisData
                     },
                 yAxis: {
                     name: '竞争力',
                     type: 'value'
                 },
                 series: [
                     {
                         name: '经营能力',
                         type: 'bar',
                         data: seriesData1
                     },
                     {
                         name: '盈利能力',
                         type: 'bar',
                         data: seriesData2
                     },
                     {
                         name: '发展能力',
                         type: 'bar',
                         barCategoryGap: '36%',
                         data: seriesData3
                     }
                 ]
             });

      	});
     }
    //获取业务总览的市场竞争力趋势
    function getCompetitiveRrend(type){
      	 $.post("${contextPath}/qdch/creditrisk/getRankByYeamount",{"jys":jysCode,"type":type},function(data){
      		console.log("--------",data)
       		var yAxisData=[];
       		var seriesData=[];
       		$.each(data,function(index,item){
       			var name="";
       			var page=parseInt(item.name.length/6);
       			if(item.name.length%6>0){
       				page++;
       			}
       			for(var x=1;x<parseInt(page)+1;x++){
       				name+=item.name.substr((x-1)*6,6)+"\n";
       			}
       			yAxisData.push(name);
       			seriesData.push(item.value);
       		});
       		ec001.setOption({
                   grid: {
                       left: "26%",
                       right: "16%",
                       top: "15%"
                   },
                   xAxis: {
                       type: 'value',
                       name: '指数'
                   },
                   yAxis: {
                       name: '市场',
                      data:yAxisData
                   },
                   series: [{
                       data: seriesData,
                       type: 'bar',
                       barWidth: "60%"
                   }]
               }); 
       	});
      } 
  
      

</script>
</body>
</html>

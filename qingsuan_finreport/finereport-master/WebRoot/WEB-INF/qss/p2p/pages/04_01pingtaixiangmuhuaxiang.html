<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="${contextPath}/static/img/com/logo.png">
    <link rel="stylesheet" href="${contextPath}/static/asserts/css/normalize.css">
    <link rel="stylesheet" href="${contextPath}/static/css/style.css">
    <link rel="stylesheet" href="${contextPath}/static/css/pageCom.css">
    <style>
        .top {
            display: flex;
            flex: 3;
        }
        .bottom {
            flex: 3;
            display: flex;
        }
        .top > div {
            flex: 1;
        }
        /*.top .top-l{*/
            /*flex: 3;*/
        /*}*/
        /*.top .top-m{*/
            /*flex: 2;*/
        /*}*/
        /*.top .top-r{*/
            /*flex: 4;*/
        /*}*/

        .bottom > .ec001 {
            flex: 0.98;
        }
        .bottom > .ec002 {
            flex: 2.02;
        }
        /*集中度*/
        .jq22-content{ width: 80%; margin:0.8rem auto;}
        .progressbar {
            width: 100%;
            margin-top: 5px;
            margin-bottom: 1rem;
            position: relative;
            box-shadow: inset 0px 1px 1px rgba(0,0,0,.1);

        }

        .proggress{
            height: 8px;
            width: 10px;
            background-color: #3498db;
        }
        /*百分百注释*/
        .percentCount{
            float:right;
            margin-top: -35px;
            clear: both;
            font-family: '微软雅黑';
            font-size: 0.6rem;
        }
        .chartBody .jq22-content h3{
            font-size: 0.7rem;
        }
    /*集中度 end*/
        /*四个小盒子*/
        .fl{
            float: left;
        }
        .fr{
            float: right;
        }
        .top-r{
            padding: 0.3rem;
        }
        .top-r_up,.top-r_down{
            width: 100%;
            height: 50%;
            margin-left: 0.2rem;
        }
        .top-r_up{
            margin-bottom: 0.2rem;
        }
        .top-r_upBox,.top-r_downBox{
            position: relative;
            width: 49%;
            height: 98%;
        }
        .picBox{
            width: 100%;
            height: 100%;
        }
        .picBox img{
            width: 100%;
            height: 100%;
        }
        .top-r_BoxContent{
            position: absolute;
            text-align: center;
            width: 50%;
            height: 50%;
            left: 25%;
            top: 25%;
        }
        .top-r_BoxContent span:nth-child(1){
            color: #fffb8f;
            font-size: 1.5rem;
            font-weight:500;
        }
        .top-r_BoxContent span:last-child{
            font-size: 0.8rem;
            color: #ffff;
        }
        .BoxContentNub+span{
            color: #fffb8f;
            font-size: 0.8rem;
            margin-left: 0.2rem;
        }
		 /*项目结构*/
        .model,.model1{
            background: url("${contextPath}/static/img/com/bg_main.jpg") no-repeat;
            position: absolute;
            left: 50%;
            top: 50%;
            border-radius: .5rem .5rem 0 0;
            width: 900px;
            height: 500px;
            margin-left: -450px;
            margin-top: -250px;
            color: #fff;
            display: none;
            z-index: 1002;

        }
        .model table,.model1 table{
            border-collapse: collapse;
            margin: 2rem auto;
            overflow: auto;
            width: 98%;
            border: 1px solid #00abde;
        }

        /* header  可以删除*/
        .header{
            position: relative;
            height: 1.8rem;
            line-height: 1.8rem;
            font-size: 0.7rem;
            border-radius: .5rem .5rem 0 0;
            background-color: #0080ff;
            padding-left: 0.3rem;
        }
        .header span{
            position: absolute;
            right: .5rem;
            top: 0.3rem;
            width: 1rem;
            height: 1rem;
            text-align: center;
            background-color: #fff;
            border-radius: 50%;
            line-height: 1rem;
            cursor: pointer;
            color: #00abde;

        }
        .icon{
            position: absolute;
            right: 0.5rem;
            top: 0;
            width: 1.8rem;
            height: 1.8rem;
            float: right;
            background:url("${contextPath}/static/img/04pingtai/eject.png") no-repeat center;
            background-size: contain;
            border-radius: 50%;
            cursor: pointer;
            line-height: 1.5rem;
        }
        .icon:hover{
            transition: all 0.2s;
            transform: scale(1.3);
        }
        #my_tr1 th,#my_tr2 th{
            font-size: .85rem;
            background-color: #00abde;
        }
        tbody > tr:nth-of-type(odd),tbody > tr:nth-of-type(even) {
            background-color: transparent;

        }
        tbody > tr > td {
            font-size: .8rem;
        }

        /*项目结构  end*/

    </style>
</head>
<body id="03_04heguifengxian" data-title="管理风险">
<div class="container">
    <h2 hidden>管理风险</h2>
    <header class="pageHeader">
        <div class="inputGroup">
            <label>平台：</label>
            <div class="mySelect" id="jingzhenglizhibiao4">
                <div class="myOption selected"><span class="text"></span><span class="icon"></span>
                </div>
                <ul class="myOptionBox" id="jysselect">
                   
                    ##for(j in jyslist!){
                                <li id="${j.jysc!}" onclick=changeJysData(this) class="myOption">${j.jysinfo!}</li>                
                               ##}
                </ul>
            </div>
        </div>
    </header>
    <div class="top">
        <!--项目结构-->
        <div class="top-l">
            <div class="chartBox ec001">
                <div class="chartTitle tck1">
                    <h3>项目结构</h3>
                    <div class="icon"></div>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec001_currentCompetitiveness"></div>
                    </div>
                </div>
            </div>
        </div>
        <!--集中度-->
        <div class="top-m">
            <div class="chartBox ec003">
                <div class="chartTitle">
                    <h3>集中度</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div class="jq22-content">
                            <h3 class="center">前十大借款人占比</h3>
                            <div id="progressbar1"></div>
                            <h3 class="center">前十大投资人占比</h3>
                            <div id="progressbar2"></div>
                            <h3 class="center">行业HHI指数</h3>
                            <div id="progressbar3"></div>
                            <h3 class="center">地区集中度</h3>
                            <div id="progressbar4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--右上侧  四个小盒子-->
        <div class="top-r">
            <div class="top-r_up">
               <div class="top-r_upBox fl">
                   <div class="picBox">
                       <img src="${contextPath}/static/img/ptxmhx.png" alt="">
                   </div>
                   <div class="top-r_BoxContent">
                       <span id="BoxContentNub01"></span><br>
                       <span>逾期率</span>
                   </div>
               </div>
               <div class="top-r_upBox fr">
                   <div class="picBox">
                       <img src="${contextPath}/static/img/ptxmhx.png" alt="">
                   </div>
                   <div class="top-r_BoxContent">
                       <span id="BoxContentNub02"></span><span>万元</span><br>
                       <span>逾期金额</span>
                   </div>
               </div>
            </div>
            <div class="top-r_down">
                <div class="top-r_downBox fl">
                    <div class="picBox">
                        <img src="${contextPath}/static/img/ptxmhx.png" alt="">
                    </div>
                    <div class="top-r_BoxContent">
                        <span class="BoxContentNub" id="BoxContentNub03"></span><span>万元</span><br>
                        <span>代偿金额</span>
                    </div>
                </div>
                <div class="top-r_downBox fr">
                    <div class="picBox">
                        <img src="${contextPath}/static/img/ptxmhx.png" alt="">
                    </div>
                    <div class="top-r_BoxContent">
                        <span class="BoxContentNub" id="BoxContentNub04"></span><span>笔</span><br>
                        <span>代偿笔数</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom">
        <!--平台期限分布-->
        <div class="chartBox ec001">
            <div class="chartTitle tck2">
                <h3>平台期限分布</h3>
                <div class="icon"></div>
            </div>
            <div class="chartContent">
                <div class="chartBody">
                    <div id="ec002_currentCompetitiveness"></div>
                </div>
            </div>
        </div>
        <!--平台利率-->
        <div class="chartBox ec002">
            <div class="chartTitle">
                <h3>平台利率</h3>
            </div>
            <div class="chartContent">
                <header>
                    <div class="inputGroup" >
                        <label style="margin-left: 1rem;">期限:</label>
                        <div class="mySelect" id="jingzhenglizhibiao2">
                            <div class="myOption selected"><span class="text" id="show_type"></span><span class="icon"></span>
                            </div>
                            <ul class="myOptionBox" id="rangetypeSelect">
                                 <li  class="myOption selected" id="全部" onclick=getCompositeInterest()>全部</li>
                                ##for(r in rangetypeList!){
                                	<li id="${r.range_type!}" onclick=changeRangeType(this) class="myOption">${r.range_type!}</li>
                                ##}
                            </ul>
                        </div>
                    </div>
                </header>
                <div class="chartBody">
                    <div id="ec001_currentCompetitiveness3"></div>
                </div>
            </div>
        </div>

    </div>
  	 <!--项目结构  弹出框 start-->
    <div class="model">
        <div class="header">项目结构详情<span>X</span></div>
        <div id="div_container1" style="text-align:center;position:relative;height: 95%; overflow: auto;">
            <!-- 固定表头 table外层必须包有一个div  id="my_div"   class="fakeContainer first_div" 引入superTables.js  在页面下面还需要调用 -->
            <div id="my_div1" class="fakeContainer first_div" >
                <table border="1" id="demoTable1" style="">
                    <tr id="my_tr1">
                        <th class="center" rowspan="1">项目类型</th>
                        <th class="center" rowspan="1">业务类型</th>
                        <th class="center" rowspan="1">平均利率</th>
                        <th class="center" rowspan="1">金额</th>
                        <th class="center" rowspan="1">金额占比</th>
                        <th class="center" rowspan="1">平均期限</th>

                    </tr>

                    <tr>
                        <td class="center ziranren" rowspan="2">信用</td>
                        <td class="center left">车押宝</td>
                        <td class="center">12%</td>
                        <td class="center">13%</td>
                        <td class="center">23%</td>
                        <td class="center">12%</td>


                    </tr>
                    <tr>
                        <td class="center left">车贷</td>
                        <td class="center">12%</td>
                        <td class="center">13%</td>
                        <td class="center">23%</td>
                        <td class="center">12%</td>




                    </tr>

                    <tr>
                        <td class="center left" rowspan="1">抵押</td>

                        <td class="center">车贷</td>
                        <td class="center">12%</td>
                        <td class="center">13%</td>
                        <td class="center">23%</td>
                        <td class="center">12%</td>
                    </tr>

                </table>
            </div>
        </div>
    </div>
    <div class="model1">
        <div class="header">项目结构详情<span>X</span></div>
        <div id="div_container2" style="text-align:center;position:relative;height: 95%; overflow: auto;">
            <!-- 固定表头 table外层必须包有一个div  id="my_div"   class="fakeContainer first_div" 引入superTables.js  在页面下面还需要调用 -->
            <div style="" id="my_div2" class="fakeContainer first_div" >
                <table border="1" id="demoTable2" style="border-collapse: collapse;overflow: auto">
                    <tr id="my_tr2">
                        <th class="center" rowspan="1">项目期限</th>
                        <th class="center" rowspan="1">平均利率</th>
                        <th class="center" rowspan="1">金额</th>
                        <th class="center" rowspan="1">金额占比</th>
                        <th class="center" rowspan="1">还款方式</th>

                    </tr>

                    <tr>
                        <td class="center">1</td>
                        <td class="center">2</td>
                        <td class="center">3</td>
                        <td class="center">4</td>
                        <td class="center">5</td>


                    </tr>
                    <tr>
                        <td class="center">1</td>
                        <td class="center">2</td>
                        <td class="center">3</td>
                        <td class="center">4</td>
                        <td class="center">5</td>




                    </tr>

                    <tr>
                        <td class="center">1</td>
                        <td class="center">2</td>
                        <td class="center">3</td>
                        <td class="center">4</td>
                        <td class="center">5</td>
                    </tr>

                </table>
            </div>
        </div>
    </div>
    <!--项目结构  弹出框 end-->
  	 
</div>
<script src="${contextPath}/static/asserts/js/echarts-4.0.js"></script>
<script src="${contextPath}/static/asserts/js/jquery-2.2.4.js"></script>
<script src="${contextPath}/static/js/main.js"></script>
<script src="${contextPath}/static/js/chartsCom.js"></script>
<script>
    var allCharts = [];
    var ec001 = echarts.init($("#ec001_currentCompetitiveness")[0]);
    var ec002 = echarts.init($("#ec002_currentCompetitiveness")[0]);
    var ec003 = echarts.init($("#ec001_currentCompetitiveness3")[0]);
//  集中度
    $(function(){
    	//弹出框
        $(".tck1 .icon").click(function () {
            $('.model').css('display','block');
            console.log('aaa');
        });

        $(".model>.header>span").click(function () {
            $('.model').hide(500)
        });
        $(".tck2 .icon").click(function () {
            $('.model1').css('display','block');
            console.log('aaa');
        });
        $(".model1>.header>span").click(function () {
            $('.model1').hide(500)
        });
        
        //percentage  数据值
        $('#progressbar1').LineProgressbar({
            percentage: 64,
            fillBackgroundColor: '#f1c40f',
            height: '15px',
            radius: '20px',
            backgroundColor:'rgba(0,0,0,0.2)'

        });
        $('#progressbar2').LineProgressbar({
            percentage: 42,
            fillBackgroundColor: 'blue',
            height: '15px',
            radius: '20px',
            backgroundColor:'rgba(0,0,0,0.2)'
        });
        $('#progressbar3').LineProgressbar({
            percentage: 4.5,
            fillBackgroundColor: '#f1c40f',
            height: '15px',
            radius: '20px',
            backgroundColor:'rgba(0,0,0,0.2)'
        });
        $('#progressbar4').LineProgressbar({
            percentage: 7.8,
            fillBackgroundColor: 'blue',
            height: '15px',
            radius: '20px',
            backgroundColor:'rgba(0,0,0,0.2)'
        });
    });

    (function($){
        'use strict';

        $.fn.LineProgressbar = function(options){

            var options = $.extend({
                percentage : null,
                ShowProgressCount: true,
                duration: 1000,

                // Styling Options
                fillBackgroundColor: '#3498db',
                backgroundColor: '#EEEEEE',
                radius: '0px',
                height: '10px',
                width: '100%'
            },options);

            return this.each(function(index, el) {
                // Markup
                $(el).html('<div class="progressbar"><div class="proggress"></div><div class="percentCount"></div></div>');



                var progressFill = $(el).find('.proggress');
                var progressBar= $(el).find('.progressbar');


                progressFill.css({
                    backgroundColor : options.fillBackgroundColor,
                    height : options.height,
                    borderRadius: options.radius
                });
                progressBar.css({
                    width : options.width,
                    backgroundColor : options.backgroundColor,
                    borderRadius: options.radius
                });

                // Progressing
                progressFill.animate(
                    {
                        width: options.percentage + "%"
                    },
                    {
                        step: function(x) {
                            if(options.ShowProgressCount){
                                $(el).find(".percentCount").text(Math.round(x) + "%");
                            }
                        },
                        duration: options.duration
                    }
                );
                ////////////////////////////////////////////////////////////////////
            });
        }
    })(jQuery);
    //集中度END
    $(function () {
        
        ec001.setOption(opt_pie);
       

       
        ec002.setOption(opt_pie);
       
       
        ec003.setOption(opt_line);
        
        //本页所有图表
        allCharts = [ec001, ec002];
      
       
    });
    var jysCode;
    var rangetype="全部";
    jysCode=$("#jysselect").find("li").eq(0).attr("id");
    init();
    function changeRangeType(obj){
		//获取交易所现在下拉选择值
		rangetype=$(obj).attr("id");
		getInterest();
		
	 }
    
    function changeJysData(obj){
		//获取交易所现在下拉选择值
		jysCode=$(obj).attr("id");
		rangetype="全部";
		init();
	 }
    function init(){
    	getProjectStructure();
        getProjectterm();
        getImportantRatio();
        if(rangetype=="全部"){
        	$("#rangetypeSelect>li").removeClass("selected");
        	$("#rangetypeSelect>li").eq(0).addClass("selected");
        	$("#show_type").html(rangetype);
        	getCompositeInterest();
        }else{
        	changeRangeType();
        }
        
    }
    //获取综合利率
    function getCompositeInterest(){
    	$.post("${contextPath}/qdch/project/getCompositeInterest",{"jys":jysCode},function(data){
    		console.log("综合利率",data);
    		var seriesData1=[];
    		var seriesData2=[];
  			var yAxisData=[];
  			$.each(data.platformcominterestList,function(index,item){
  				yAxisData.push(item.vday_ym);
  				seriesData1.push(item.interestnum);
  				
  			})
  			$.each(data.industryinterestList,function(index,item){
  				
  				seriesData2.push(item.interestnum);
  				
  			})
  			console.log("YUEYUEYUE",seriesData1);
  			ec003.setOption({
  	            grid: {
  	                top: "12%",
  	                right:'5%',
  	                left:'5%',
  	                bottom: '15%'
  	            },
  	            legend: {
  	                show: false
  	            },
  	            xAxis: {
  	                name: '月份',
  	                data: yAxisData
  	            },
  	            yAxis: {
  	                name: '利率'
  	            },
  	            series: [
  	                {
  	                    name: '平台综合利率',
  	                    type: 'line',
  	                    symbol: 'circle',
  	                    data: seriesData1,
  	                    areaStyle: lineAreaStyle(0)

  	                },
  	              {
  	                    name: '行业综合利率',
  	                    type: 'line',
  	                    symbol: 'circle',
  	                    data: seriesData2,
  	                    areaStyle: lineAreaStyle(0)

  	                }
  	            ]
  	        });
  			
  		})
    }
    //获取项目结构
    function getProjectStructure(){
      	 $.post("${contextPath}/qdch/project/getProjectStructure",{"jys":jysCode},function(data){   		
       		
       		var seriesData=[];
       		$.each(data,function(index,item){       		
	    			seriesData.push({value:item.value, name:item.iterm_type});    			
      	 		});
       		console.log("---项目结构-----",seriesData)    		
       		ec001.setOption(opt_pie);
       	    ec001.setOption({
              
                grid:{
                    top:'10%',
                    left:'10%',
                    right:'10%',
                    bottom:'10%'
                },
                series : [
                    {
                        name:'项目结构',
                        type:'pie',
                        radius : '70%',
                        center: ['50%', '50%'],
                        data: seriesData
                    }
                ]
            });


       		
       		
       	});
      } 
    //获取平台期限分布
    function getProjectterm(){
      	 $.post("${contextPath}/qdch/project/getProjectStructure",{"jys":jysCode},function(data){   		
       		
       		var seriesData=[];
       		$.each(data,function(index,item){       		
	    			seriesData.push({value:item.value, name:item.iterm_term});    			
      	 		});
       		console.log("---平台期限分布-----",seriesData)    		
       		
       		ec002.setOption({
             
                grid:{
                    top:'10%',
                    left:'10%',
                    right:'10%',
                    bottom:'10%'
                },
                series : [
                    {
                        name:'平台期限分布',
                        type:'pie',
                        radius : '70%',
                        center: ['50%', '50%'],
                        data: seriesData
                    }
                ]
            });

			
       		
       		
       	});
      } 
  //获取四个重要比率
    function getImportantRatio(){
      	 $.post("${contextPath}/qdch/project/getImporttantRatio",{"jys":jysCode},function(data){
      		console.log("比率",data[2]);
      		
      		var yql=data[0].yql;
      		var yqje=data[0].yqje;
      		var dcje=data[0].dcje;
      		var dcbs=data[0].dcbs;
      		
      		if(yql == null ){
      			yql="/";
      		}
      		if(yqje == null ){
      			yqje="/";
      		}
      		if(dcje == null ){
      			dcje="/";
      		}
      		if(dcbs == null ){
      			dcbs="/";
      		}
       		$("#BoxContentNub01").html(yql);
       		$("#BoxContentNub02").html(yqje);
       		$("#BoxContentNub03").html(dcje);
       		$("#BoxContentNub04").html(dcbs);     		
       	});
      } 
  	function getInterest(){
  		$.post("${contextPath}/qdch/project/getInterest",{"jys":jysCode,"rangeType":rangetype},function(data){
  			var seriesData=[];
  			var yAxisData=[];
  			$.each(data,function(index,item){
  				yAxisData.push(item.vday);
  				seriesData.push(item.interest);
  				
  			})
  			console.log("=========利率========",data)
  			ec003.setOption({
  	            grid: {
  	                top: "12%",
  	                right:'5%',
  	                left:'5%',
  	                bottom: '15%'
  	            },
  	            legend: {
  	                show: false
  	            },
  	            xAxis: {
  	                name: '月份',
  	                data: yAxisData
  	            },
  	            yAxis: {
  	                name: '利率'
  	            },
  	            series: [
  	                {
  	                    name: '利率',
  	                    type: 'line',
  	                    symbol: 'circle',
  	                    data: seriesData,
  	                    areaStyle: lineAreaStyle(0)

  	                }
  	            ]
  	        });
  		})
  	}
</script>
</body>
</html>

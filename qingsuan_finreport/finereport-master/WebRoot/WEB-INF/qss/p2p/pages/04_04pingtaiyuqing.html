<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="${contextPath}/static/img/com/logo.png">
    <link rel="stylesheet" href="${contextPath}/static/asserts/css/normalize.css">
    <link rel="stylesheet" href="${contextPath}/static/css/style.css">
    <link rel="stylesheet" href="${contextPath}/static/css/pageCom.css">
    <link rel="stylesheet" href="${contextPath}/static/css/laydate.css">
     <link rel="stylesheet" href="${contextPath}/static/css/page.css">
    <style>
         .pageBody {
            display: flex;
            flex: 1;
        }
        .left {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .left > div {
            flex: 1;
            height: 50%;
        }
        .right {
            flex: 2;
            display: flex;
            flex-direction: column;
        }
        .topBox {
            flex: 3;
            display: flex;
            flex-direction: row;
            height: 30%;
        }
        .topBox > div {
            flex: 1;
        }
        .bottomBox {
            flex: 7;
            height: 70%;
        }
        .fl {
            float: left;
        }
        .fr {
            float: right;
        }
        a {
            text-decoration: none;
        }
   
        .chartBody1{
        	height:100%;
        }
        /*客户黑名单*/
        .customerSelect {
            padding: 0.5rem 1rem;
        }
        .btnGroup1 {
            margin-top: 10px;
        }
         #table tbody tr td,#table1 thead tr th{
            width: 20%;
            text-align: center;
            font-size: 0.65rem;

        }
        .timeUstyle {
            background: transparent;
            border: 2px solid #00abde;
            width: 9rem;
            border-radius: 0.1rem;
            height: 28%;
            line-height: 28%;
        }
        .endTimeContent {
            margin-left: 5%;
        }
        /*修改输入框 placeholder字体颜色 start*/
        input:-moz-placeholder,
        textarea:-moz-placeholder {
            color: #fff;
            vertical-align: middle;
        }
        input:-ms-input-placeholder,
        textarea:-ms-input-placeholder {
            color: #fff;
            vertical-align: middle;
        }
        input::-webkit-input-placeholder,
        textarea::-webkit-input-placeholder {
            color: #fff;
            vertical-align: middle;
        }
        /*修改输入框 placeholder字体颜色 END*/
        /*customerInformationList start*/
        
        /*查询*/
        .yuqingsearch{
            padding:0rem 2rem;
            background: #00abde;
            border: 2px solid #00abde;
            margin-top: 50%;
            border-radius: 0.1rem;
        }

        /*舆情详情 图片展示区*/
        .customerInformationList {
            position: relative;
            width: 100%;
            height: 63%;
        }
        .leftBox {
            width: 100%;
            height: 100%;
            overflow: auto;
        }

        /*舆情详情 输入框*/
        .customerInformation {
            width: 100%;
            height: 27%;
            padding: 0.8rem 0;
            border-bottom: 2px solid #00adef;
        }
        .customerInformationleft,.customerInformationmiddle{
        	padding-top: 0.5rem;
            width: 33.33%;
            height: 100%;
        }
        /*下拉框宽度重新定义*/
        .mySelect{
            width: 9rem;
        }
        /*关键字输入框*/
        .gjz{
            width: 9rem;
            background: transparent;
            border: 2px solid #00abde;
            border-radius: 0.1rem;
        }
        
        /*最新资讯*/
        #informationBox1{
            width: 100%;
            height: 100%;
            margin: 0 auto;
            /*background: pink;*/
        }

        .myscroll1{
            width: 100%;
            height: 220px;
            /*border: 1px solid #000;*/
            overflow: hidden;
        }
        .myscroll1 li{
            list-style: none;
            height: 45px;
            line-height: 16px;
            margin-left: 20px;

        }
        .myscroll1 li a{
            font-size:0.8rem;
            color: #fff;
            text-decoration: none;
        }
        #informationBox1 li>a:hover{
            color:#006aa3;
        }

        /*图文展示*/

        .infomationContent {
            float: left;
            width: 100%;
            height: 100%;
        }
        .infomationContent > h2 > span {
            font-size: 1rem;
            font-weight: normal;
        }
        .infomationContent > ul > li {
            width: 100%;
            color: #756F71;
            padding: .1rem 0.1rem;
            font-size: 12px;
        }
        .infomationContent > ul > li > .pic {
            width: 16%;
            height: 16%;
            margin: 1%;
        }
        .infomationContent > ul > li > div > img {
            width: 100%;
            height: 100%;
            margin-left: 0.5rem;
        }
        .infomationContent > ul > li > p {
            width: 78%;
            padding: 0.2rem 0.2rem;
        }
        .infomationContent > ul > li > p > .neirong {
            margin: 0.1rem 0 0.5rem 0;
            color: #00b0f4;
            font-size: 0.8rem;
        }
        .infomationContent > ul > li > p > span {
            line-height: 1.3rem;
            display: inline-block;
            margin: 0 .5rem .5rem .5rem;
        }
        .bgi4 {
            background: url("../img/03_05shengyufengxian/lticn_eye.png") no-repeat left center;
            padding-left: 1rem;
            width: 0.6rem;
            background-size: contain;
        }
        .infomationContent > ul > li > p > a:first-child {
            display: block;
            font-size: 0.95rem;
            font-weight: bold;
            margin-bottom: 0.5rem   ;
        }
        .infomationContent > ul > li > p a {
            color: #fff;
        }
        /*分页样式*/
       
        .page{
            width: 98%;
            margin:0 auto;
        }
        
        .leftBox .kuaizhao a{
            color: #faad14;
        }
    </style>
</head>
<body id="04_04pingtaiyuqing" data-title="平台舆情">
<div class="container">
    <h2 hidden>声誉风险</h2>
    <div class="pageBody">
        <div class="left">
            <div class="left-top">
                <div class="chartBox ec001">
                    <div class="chartTitle">
                        <h3>市场舆情概览</h3>
                    </div>
                    <div class="chartContent">
                        <div class="chartBody">
						
							    <div class="inputGroup" style="margin-top: 0.2rem">
							        <label>交易市场:</label>&nbsp;&nbsp;
							        <div class="mySelect">
							            <div class="myOption selected"><span class="text"></span><span class="icon"></span></div>
							            <ul class="myOptionBox">
							            	<li class="myOption selected liandong" value="">全部</li>
							                ##for(p in flist){
                                               		<li class="myOption liandong" value="${p.jysinfo!}">${p.jysinfo!}</li>
                                                ##}
							            </ul>
							        </div>
							    </div>
						
							
	                         <div id="ec_03_05shichangyuqinggailan"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="left-bottom">
                <div class="chartBox ec002">
                    <div class="customerSelect">
                        <div class="btnGroup btnGroup1">
                            <button class="active">纠纷客户名单</button>
                            <button>客户黑名单</button>
                        </div>
                    </div>
                   <div class="chartContent">
                        <table id="table1" align="center" width="100%">
                            <thead style="font-size: 0.8rem;">
                            <tr><th>时间</th><th>投诉人</th><th>投诉电话</th><th>投诉原因</th><th>查看详情</th>
                            </tr>
                            </thead>
                        </table>
                        <div style="overflow-x: auto; overflow-y: auto; height: 100%; width:100%;">
                            <table id="table" width="100%" height="100%">
                                <tbody>
                                	<tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                 	<tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                  	<tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                   	<tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                 	<tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                  	<tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                   	<tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                    <tr><td>20180307</td><td>王建国</td><td>15888888888</td><td>交易市场</td><td class="more"> 查看</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="right">
            <div class="topBox">
                <!--实时舆情-->
                <div class="topBox1">
                    <div class="chartBox ec002">
                        <div class="chartTitle">
                            <h3>实时舆情</h3>
                        </div>
                        <div class="chartContent">
                            <div class="chartBody">
                                <div id="ec_shishiyuqing001"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--最新资讯-->
                <div class="topBox2">
                    <div class="chartBox ec002">
                        <div class="chartTitle">
                            <h3>最新资讯</h3>
                        </div>
                        <div class="chartContent">
                            <div class="chartBody">
                                <div id="informationBox1">
								    <div class="myscroll1">
								        <ul id="gundong">
								         <!-- <li>1</li>
								          <li>1</li>
								          <li>1</li>
								          <li>1</li>
								          <li>1</li> -->
								        </ul>
								    </div>
								</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--右下侧部分  舆情详情-->
            <div class="bottomBox">
                <div class="chartBox ec002">
                    <div class="chartTitle">
                        <h3>舆情详情</h3>
                    </div>
                    <!--舆情详情-->
                    <div class="chartContent">
                        <div class="chartBody chartBody1">
                            <div class="customerInformation">
                                <div class="customerInformationleft fl">
                                    <div class="inputGroup fl">
                                        <label class="jiaoyishichang">交易市场:</label>&nbsp;&nbsp;
                                        <div class="mySelect" id="jiaoyishichang" >
                                            <div class="myOption selected" style="border:0.15em solid  #00abde;"><span class="text"></span><span class="icon"></span></div>
                                            <ul class="myOptionBox">
                                            	<li class="myOption selected jysc" value="">全部</li>
                                                
                                            	##for(p in flist){
                                               		<li class="myOption jysc" value="${p.enterprise_id!}">${p.jysinfo!}</li>
                                                ##}
                                            </ul>
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <div class="inputGroup fl">
                                        <label for="BeginTime">开始时间：</label>
                                        <input placeholder="请输入开始日期" id="BeginTime" class="laydate-icon timeUstyle stateUTime"
                                               onclick="laydate({istime: true,format:'YYYY-MM-DD '})">
                                        <!--<input type="Date" id="BeginTime">-->
                                    </div>
                                </div>
                                <div class="customerInformationmiddle fl">
                                    <div class="inputGroup fl">
                                        <label class="guanjianzi">关键字:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <input type="text" class="gjz" placeholder="青岛华银有限公司">

                                    </div>
                                    <br>
                                    <br>
                                    <div class="inputGroup fl">
                                        <label for="EndTime">结束时间：</label>
                                        <input placeholder="请输入开始日期" id="EndTime" class="laydate-icon timeUstyle stateUTime"
                                               onclick="laydate({istime: true,format:'YYYY-MM-DD '})">
                                        <!--<input type="Date" id="EndTime">-->
                                    </div>
                                </div>
                                <div class="customerInformationright fl">

                                    <div class="inputGroup">
                                        <button class="yuqingsearch">查询</button>
                                    </div>
                                </div>
                            </div>
                            <div class="customerInformationList">
                                <div class="infomationContent fl">
                                    <ul class="leftBox">
                                   		
                                    </ul>
                                </div>
                                
                            </div>
                            <ul class="page" maxshowpageitem="5" pagelistcount="5"  id="page"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="${contextPath}/static/asserts/js/echarts-4.0.js"></script>
<script src="${contextPath}/static/asserts/js/jquery-2.2.4.js"></script>
<script src="${contextPath}/static/js/chartsCom.js"></script>
<script src="${contextPath}/static/js/pageCom.js"></script>
<script src="${contextPath}/static/js/laydate.js"></script>
<script src="${contextPath}/static/js/pagefenye.js"></script>
<script>


// JavaScript Document  滚动
(function($){
    $.fn.myScroll = function(options){
        //默认配置
        var defaults = {
            speed:1,  //滚动速度,值越大速度越慢
            rowHeight:45 //每行的高度
        };

        var opts = $.extend({}, defaults, options),intId = [];

        function marquee(obj, step){

            obj.find("ul").animate({
                marginTop: '-=1'
            },0,function(){
                var s = Math.abs(parseInt($(this).css("margin-top")));
                if(s >= step){
                    $(this).find("li").slice(0, 1).appendTo($(this));
                    $(this).css("margin-top", 0);
                }
            });
        }

        this.each(function(i){
            var sh = opts["rowHeight"],speed = opts["speed"],_this = $(this);
            intId[i] = setInterval(function(){
                if(_this.find("ul").height()<=_this.height()){
                    clearInterval(intId[i]);
                }else{
                    marquee(_this, sh);
                }
            }, speed);

            _this.hover(function(){
                clearInterval(intId[i]);
            },function(){
                intId[i] = setInterval(function(){
                    if(_this.find("ul").height()<=_this.height()){
                        clearInterval(intId[i]);
                    }else{
                        marquee(_this, sh);
                    }
                }, speed);
            });

        });

    }

})(jQuery);


    var allCharts = [];
    var fxyq001;
    var fxyq002;
    $(function () {
    	var pageSize=$("#page").attr('pagelistcount');
    	var currentPage;
		
    	
		
    	/*-----------分页---------*/
        function tt(dd){
            //alert(dd);
        }
        var GG = {
            "kk":function(mm){
                //alert(mm);
                currentPage = mm
                detail();
            }
        }
       $("#page").initPage(pageSize,1,GG.kk);
        /*-----------分页---------*/
        detailCount();
    	detail();
    	realCompanyFeel();
    	overView();
    	getNews();
    	
    	/*-----全局变量--------*/
       var jysinfo = "";
       var jysc = "";
       var startTime = "";
       var endTime = "";
       var keyword = "";
       
       /*-----全局变量--------*/
      
       $(".jysc").click(function () {
			jysc = $(this).attr('value');
	   })
	   $(".liandong").click(function () {
		   jysinfo = $(this).attr('value');
			realCompanyFeel();
			getNews();
		})
	   $(".yuqingsearch").click(function () {
			startTime = $("#BeginTime").val().substring(0,4)+$("#BeginTime").val().substring(5,7)+$("#BeginTime").val().substring(8,10)
			endTime = $("#EndTime").val().substring(0,4)+$("#EndTime").val().substring(5,7)+$("#EndTime").val().substring(8,10)
			keyword = $(".gjz").val();
			
			/* if (startTime > endTime) {
				alert("结束时间不能小于开始时间");
				return;
			} */
			
			detail();
			detailCount();
	   })
     	/*-----------------市场舆情浏览 模块一 ---------------*/
       function overView() {
  		 
          $.post("${contextPath}/qdch/companyfeel/getOverviewCompanFeel",function(data){
          	var seriesData = [];
          	$.each(data,function(index,item){
          		seriesData.push({value:item.qty,name:item.jysinfo});
          	})
          	console.log(seriesData);
          	 fxyq001 = echarts.init($("#ec_03_05shichangyuqinggailan")[0]);
               fxyq001.setOption(opt_pie);
               fxyq001.setOption({
              	 label: {
                       fontSize:10,
                       
                   },
                   legend:{
                  	 show:false,
                       textStyle:{
                           fontSize:12
                       }
                   },
                   series: [
                       {
                           name:'',
                           type: 'pie',
                           radius: '50%',
                           center: ['50%', '50%'],
                           data: seriesData
                       }
                   ]
               });
          })
		}
       /*-----------------市场舆情浏览 模块一 ---------------*/
        /*-----------------实时舆情 ---------------*/
       function realCompanyFeel(){
   		$.post("${contextPath}/qdch/companyfeel/getRealCompanyFeel",{"jysinfo":jysinfo},function(data){
   	    	   var xAxisData = [];
   	    	   var seriesData = [];
   	    	   var length = data.length;
   	    	  
   	    	   $.each(data,function(index,item){
   	    		   xAxisData.push(item.publish_date);
   	    		   seriesData.push(item.qty);
   	    	   })
   	    	   console.log(xAxisData);
   	    	   console.log(seriesData);
   	    	   //实时舆情
   	           fxyq002 = echarts.init($("#ec_shishiyuqing001")[0]);
   	           fxyq002.setOption(opt_com);
   	           fxyq002.setOption(opt_line);
   	           fxyq002.setOption({
   	               legend: {
   	                   show: false
   	               },
   	               grid: {
   	                   top: '20%',
   	                   left: '10%',
   	                   right: '10%',
   	                   bottom: '20%'
   	               },
   	               xAxis: {
   	                   name: '日',
   	                   // type: 'category',
   	                   // boundaryGap: false,
   	                   data: xAxisData
   	               },
   	               yAxis: {
   	                   name: '热度值',
   	                   type: 'value'

   	               },
   	               series: [
   	                   {
   	                       name: '数量',
   	                       type: 'line',
   	                       symbol: 'circle',
   	                       data: seriesData,
   	                       areaStyle: {
   	                           color: {
   	                               x: 0,
   	                               y: 0,
   	                               x2: 0,
   	                               y2: 1,
   	                               colorStops: [{
   	                                   offset: 0, color: colors[0] // 0% 处的颜色
   	                               }, {
   	                                   offset: 1, color: '#00adef11' // 100% 处的颜色
   	                               }]
   	                           }
   	                       }
   	                   }

   	               ]
   	           });
   	       })
   	}
    /*-----------------实时舆情 ---------------*/
    /*-----------------最新资讯 ---------------*/
       function getNews(){
    	   $.post("${contextPath}/qdch/companyfeel/getNews",{"jysinfo":jysinfo},function(data){
        	   var content = "";
        	   $.each(data,function(index,item){
        		   if (item.news != null) {
        			   content = content
            		   +' <li><a href="#68.html">'+item.news+'</a></li>'
					}  
        	   })
        	 $(".myscroll1").find("ul").html(content);
        	   $('.myscroll1').myScroll({
        	        speed: 100, //数值越大，速度越慢
        	        rowHeight: 45 //li的高度
        	    });
           })
       }
       /*-----------------最新资讯 ---------------*/
       
       /*-----------------舆情详情 ---------------*/
       function detail() {
    	   $.ajax({
				type:"POST",
				url:"${contextPath}/qdch/companyfeel/getDetailCompanyFeel",
				data:{"jysc":jysc,"startTime":startTime,"endTime":endTime,"keyword":keyword,"pageSize":pageSize,"currentPage":currentPage},
				dataType:"json",
				success:function(data){
					console.log(data);
					var content = ""
					$.each(data,function(data,item){
						
						
						content = content
						+' <li class="fl">'
						+'		<div class="fl pic"><img src="${contextPath}/static/img/03_05shengyufengxian/02.png"></div>'
						+'		<p class="fr">'
						+'   	<a href="'+item.url+'" target="_blank">'+item.title+'</a>'
						+'    	<span class="neirong">'+item.summary+'</span>'
						+'   	<span>来源:</span><a href="#" class="bgi1 source2">'+item.data_source+'</a>'
						+'    	<span>|</span>'
						+'      <span>涉及词:</span><a href="#">'+item.string_agg+'</a>'
						+'    	<span class="bgi4"><a href="#">256</a></span>'
						+'     	<span class="fr bgi2">'+item.publish_date+'</span>'
						+'		<span class="fr kuaizhao"><a class="aid" target="_blank">快照</a></span>'
						+'		<input type="hidden" value="'+item.content+'" class="con" />'
						+' 		</p>'
						+'</li>'
					})
					$(".leftBox").html(content);
				}
			})
		}
       /*-----------------舆情详情---------------*/
      $("body").on("click", ".aid", function() {
    	  var content = $(this).parent().siblings(".con").val();
    	  	var p='<html><head><title>舆情信息</title></head><body><div>'+content+'</div></body></html>';
			w=window.open('about:blank');
			w.document.write(p)
			
      	})
        /*-----------------舆情详情条数 ---------------*/
       function detailCount() {
    	   
    	   $.ajax({
				type:"POST",
				url:"${contextPath}/qdch/companyfeel/getDetailCount",
				data:{"jysc":jysc,"startTime":startTime,"endTime":endTime,"keyword":keyword,"pageSize":pageSize,"currentPage":currentPage},
				dataType:"json",
				success:function(data){
					console.log(data);
					var content = ""
					$.each(data,function(data,item){
						$("#page").initPage(item.count,1,GG.kk);
					})
					
				}
			})
		}
       /*-----------------舆情详情条数---------------*/
       
       
       
       
        //当前时间
        //本页所有图表
        allCharts = [fxyq001, fxyq002];
      	
        
    });

</script>
</body>
</html>

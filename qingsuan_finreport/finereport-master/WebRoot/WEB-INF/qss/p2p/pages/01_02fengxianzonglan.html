<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="${contextPath}/static/img/com/logo.png">
    <link rel="stylesheet" href="${contextPath}/static/asserts/css/normalize.css">
    <link rel="stylesheet" href="${contextPath}/static/css/style.css">
    <link rel="stylesheet" href="${contextPath}/static/css/pageCom.css">
    <style>
        .fl{
            float: left;
        }
        .fr{
            float: right;
        }
        .container {
		    display: block;
		    flex-direction: row;
		}
       .main {
       		height:100%;
        }
        .main > div {
            height: 33.33%;
        }
        .chartBox{
        	display: block;
    		flex-direction: row;
		    margin: 0 .5rem;
        }
        .chartTitle_right img{
            width: 0.8rem;
            height: 0.8rem;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        .chartTitle_right{
            position: absolute;
            right: 1rem;
        }
        .chartBox > .chartContent{
    	    display: block;
		    flex-direction: row;
            height: calc(100% - 2rem);
        }
        .chartBox > .chartContent > .chartBody{
        	position: relative;
    		height: 100%;
        }
        .dayin h5{
            vertical-align: middle;
            font-size: 0.6rem;
        }
        .chartTitle_right h5{
            display: inline-block;
            vertical-align: middle;
			cursor: pointer;
        }
      	.chartBodyLeft{
      		/*width:7.5rem;*/
      		width:120px;
      		height: 100%;
      	}
		.chartBodyRight{
			width:calc(100% - 560px);
			height: 100%;
			/*background: rgba(255,255,255,.05);*/
		    /*position: relative;*/
    		/*margin-left: calc(160px + 7.5rem);*/
    		/*margin-left: 280px;*/
		}
        .chartBodyLeftTop{
    		padding: 10px 20px;
    		position: relative;
		    top: 50%;
    		margin-top: -65px;
        }
        .chartBodyLeftTop > img{
        	width:80px;
        	opacity: 0.8;
        	filter:alpha(opacity:80);
    	    display: block;
        }
        .chartBodyLeftTop p{
        	text-align: center;
        	font-size: 0.8rem;
        }
		.rank{
			position: absolute;
		    top: 40px;
		    left: 55px;
		    font-weight: 600;
		}
		.chartBodyLeftTop p img{
			width:0.5rem;
		}
		.chartBodyRightCircle{
			width:160px;
			height: 100%;
			position: relative;
			/*background: rgba(255,255,255,.05);*/
		}
		canvas{
			position: absolute;
			top:50%;
			left: 50%;
			margin-top:-65px;
			margin-left: -65px;
		}
		.chartBodyNumber{
			position: absolute;
			width: 100%;
			text-align: center;
			top: 52%;
		}
		.chartBodyNumber > p{
			/*position:absolute;
			top:50%;
		    left: 50%;*/
		    font-size: 0.8rem;
		    /*margin-left: -1.5rem;
		    margin-top: 0.5rem;*/
		}
		.chartBodyNumber > div{
			/*position: absolute;
		    top: 67%;
		    left: 50%;*/
	        font-size: 0.8rem;
    		/*margin-left: -6px;*/
		}
		.chartBodyRightList{
			width:100%;
			height:100%;
		}
		.chartBodyRightList ul{
			/*height:130px;
		    position: relative;
		    top: 50%;
		    margin-top: -65px;*/
		   height: 100%;
		}
		.chartBodyRightList ul li{
			float: left;
			height: 35%;
			border: 2px solid #2386C0;
			border-radius: 3px;
			margin-left: 7%;
			margin-top: 2%;
			width: 24%;
		}
		.chartBodyRightList ul li h3{
			font-size: 1.4rem;
		}
		.chartBodyRightList ul li div{
			font-size: 0.75rem;			
		}
		.chartBodyRightList ul li div em{
			font-style: normal;
		    margin-right: 0.4rem;
		}
		.liContent{
		    margin-right: 0.8rem;
		}
		.chartBodyRightList ul li div img{
			width:0.5rem;
			vertical-align: middle;
		}
		.colorUp{
			color:#FF4D4F;
		}
		.colorDown{
			color:#73D13D;
		}
		.colorJust{
			color:#00ADEF;
		}
		.colorHigh{
			color:#FF4D4F;
		}
		.colorMiddle{
			color:#FA8C16;
		}
		.colorLow{
			color:#52C41A;
		}
		.chartBodyCharts{
			width:280px;
			height:100%;
			position: relative;
		}
		.chartsAll{
			width:280px;
			height:130px;
			position: absolute;
			top:50%;
			left:50%;
			margin-top:-65px;
			margin-left: -140px;
		}
        /*左侧综合得分部分 end*/
    </style>
</head>
<body id="04_01jingyingnengli" data-title="经营能力" style="overflow-y: auto;">
<div class="container">
    <div class="main">
       
        
       

        
    </div>
</div>

<script src="${contextPath}/static/asserts/js/echarts-4.0.js"></script>
<script src="${contextPath}/static/asserts/js/jquery-2.2.4.js"></script>
<script src="${contextPath}/static/js/main.js"></script>
<script src="${contextPath}/static/js/chartsCom.js"></script>
<script type="text/javascript">

	 /**  
     * 描述：js实现的map方法 
     * @returns {Map} 
     */  
    function Map(){  
     var struct = function(key, value) {  
      this.key = key;  
      this.value = value;  
     };  
    // 添加map键值对  
     var put = function(key, value){  
       for (var i = 0; i < this.arr.length; i++) {  
       if ( this.arr[i].key === key ) {  
        this.arr[i].value = value;  
        return;  
       }  
      };  
      this.arr[this.arr.length] = new struct(key, value);  
     };  
    //  根据key获取value   
     var get = function(key) {  
      for (var i = 0; i < this.arr.length; i++) {  
       if ( this.arr[i].key === key ) {  
        return this.arr[i].value;  
       }  
      }  
     return null;  
     };  
    //   根据key删除  
     var remove = function(key) {  
      var v;  
      for (var i = 0; i < this.arr.length; i++) {  
       v = this.arr.pop();  
       if ( v.key === key ) {  
        continue;  
       }  
       this.arr.unshift(v);  
      }  
     };  
    //   获取map键值对个数  
     var size = function() {  
      return this.arr.length;  
     };  
    // 判断map是否为空    
     var isEmpty = function() {  
      return this.arr.length <= 0;  
     };  
     this.arr = new Array();  
     this.get = get;  
     this.put = put;  
     this.remove = remove;  
     this.size = size;  
     this.isEmpty = isEmpty;  
    }  
	  getData();
	  function getData(){
		$.post("${contextPath}/qdch/risk/getRiskIndex",function(data){
			var htmls="";
			var seriesDataMap=new Map();
			var yAxisDataMap=new Map();
			$.each(data,function(index,item){
					var seriesData=[];
					var yAxisData=[];
					htmls+="<div class='main-first'>"
						htmls+="<div class='chartBox ec003'>"
						htmls+="<div class='chartTitle'>"
						htmls+="<h3>"+item.jysinfo+"</h3>"
						htmls+="<div class='chartTitle_right'>"
						htmls+="<div class='dayin fr'>"
						htmls+="<h5>查看监管报告</h5>"
						htmls+="</div>"
						htmls+="</div>"
						htmls+="</div>"
						htmls+="<div class='chartContent'>"
						htmls+="<div class='chartBody'>"
						htmls+="<div class='chartBodyLeft fl'>"
						htmls+="<div class='chartBodyLeftTop'>"
							var riskRank=item.keypm*1;
							var risk=item.value*1;
						    if(risk>7 && risk<=10){
						    	htmls+="<img src='${contextPath}/static/img/high.png' alt=''/>"
						    }else if(risk>3 && risk<=7){
						    	htmls+="<img src='${contextPath}/static/img/middle.png' alt=''/>"
						    }else if(risk>0 && risk<=3)
						    {
						    	htmls+="<img src='${contextPath}/static/img/low.png' alt=''/>"
						    }
						
						htmls+="<span class='rank'>"+item.keypm+"</span>"
						htmls+="<p>风险排名</p>"
							var riskRankingCom=item.keypm*1-item.pre_keypm*1;
							var riskRanking=Math.abs(riskRankingCom);
							if(riskRankingCom*1<0){
								
								htmls+="<p><img src='${contextPath}/static/img/up.png' alt='' /><span class='colorUp'>"+riskRanking+"</span></p>"
								
							}else if(riskRankingCom*1==0){
								htmls+="<p><img src='${contextPath}/static/img/just.png' alt='' /><span class='colorJust'>"+riskRanking+"</span></p>"
								
							}else if(riskRankingCom*1>0){
								htmls+="<p><img src='${contextPath}/static/img/down.png' alt='' /><span class='colorDown'>"+riskRanking+"</span></p>"
								
							}
						
						htmls+="</div>"
						htmls+="</div>"
						htmls+="<div class='chartBodyRightCircle fl'>"
						htmls+="<canvas id='canvas"+item.keypm+"'>当前浏览器不支持canvas 请升级！</canvas>"
						htmls+="<div class='chartBodyNumber'>"
						htmls+="<p>风险指数</p>"
						htmls+="<div></div>"
						htmls+="</div>"
						htmls+="</div>"
						htmls+="<div class='chartBodyRight fl'>"
						htmls+="<div class='chartBodyRightList fl'>"
						htmls+="<ul>"	
						$.each(item.detaildata,function(ind,it){
				  			yAxisData.push({name:it.fxlb})
				  			seriesData.push(it.detailvalue); 
							htmls+="<li>"
							htmls+="<h3>"+it.detailvalue+"</h3>\n"
							htmls+="<div>"
							htmls+="<span class='liContent'>"+it.fxlb+"</span>\n"
							htmls+="<em>排名：<span>"+it.detailpm+"</span></em>\n"
							var RankingCom=it.detailpm*1-it.old_pm*1;
							var Ranking=Math.abs(RankingCom);
							
							if(RankingCom*1<0){
								
								htmls+="<img src='${contextPath}/static/img/up.png' alt='' />\n"
								htmls+="<small class='colorUp'>"+Ranking+"</small>\n"
							}else if(RankingCom*1==0){
								console.log("==============进入到判断============")
								htmls+="<img src='${contextPath}/static/img/just.png' alt='' />\n"
								htmls+="<small class='colorJust'>"+Ranking+"</small>\n"
							}else if(RankingCom*1>0){
								htmls+="<img src='${contextPath}/static/img/down.png' alt='' />\n"
								htmls+="<small class='colorDown'>"+Ranking+"</small>\n"
							}
							
							htmls+="</div>\n"
							htmls+="</li>"
							if(ind==2){
								
								htmls+="<br>"
							}
							
						});			
						htmls+="</ul>"
					    htmls+="</div>"
					    htmls+="</div>"
					    htmls+="<div class='chartBodyCharts fr'>"
					    htmls+="<div id='charts"+item.keypm+"' class='chartsAll'></div>"
					    htmls+="</div>"
					    htmls+="</div>"
					    htmls+="</div>"
					    htmls+="</div>"
					    htmls+="</div>";
					    
						seriesDataMap.put(item.keypm,yAxisData);
						yAxisDataMap.put(item.keypm,seriesData);
				});
			
				$(".main").html(htmls);
				$.each(data,function(index,item){
					charts("charts"+item.keypm,yAxisDataMap.get(item.keypm),seriesDataMap.get(item.keypm));
					canvasAll("canvas"+item.keypm+"",item.value); 
				});
			});		
	};
	 
	
	 
	
	
	
	function charts(id,yAxisData,seriesData){
		var fontSize = 0;
		var parentW = $("#01_02fengxianzonglan", parent.document).width();
		if(screen.width == 1920){
			fontSize = 16;
		}
		else if(screen.width == 1600){
			fontSize = 12;
		}
		else if(screen.width == 1440){
			fontSize = 11;
		}
		else{
			fontSize = 10;
		}
		var allCharts = [];
        var myChart1 = echarts.init($("#"+id)[0]);
        console.log(myChart1,yAxisData)
        myChart1.setOption(opt_com);
       
         myChart1.setOption({
            tooltip: {},
            legend: {
                show:false
            },
            radar: {
                center:['50%','50%'],
                radius:'60%',
                name: {
                    textStyle: {
                        color: '#fff',
                        fontSize:fontSize

                    }
                },
                axisLine: {
                    lineStyle: {
                        color: '#00abde'
                    }
                },
                splitLine: {
                    lineStyle: {
                        color: '#00abde'
                    }
                },
                splitArea: {
                    show: false
                },
                indicator: seriesData
            },
            series: [{
                name: '预算 vs 开销（Budget vs spending）',
                type: 'radar',
                areaStyle: {normal: {}},
                data : [
                    {
                         value :yAxisData , 
                        name : '预算分配（Allocated Budget）'
                    }

                ]
            }]
        }); 
    }
</script>
</body>
</html>


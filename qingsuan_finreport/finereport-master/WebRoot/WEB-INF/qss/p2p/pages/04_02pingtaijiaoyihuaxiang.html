<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="${contextPath}/static/img/com/logo.png">
    <link rel="stylesheet" href="${contextPath}/static/asserts/css/normalize.css">
    <link rel="stylesheet" href="${contextPath}/static/css/style.css">
    <link rel="stylesheet" href="${contextPath}/static/css/pageCom.css">
    <style>
        .top {
            display: flex;
            flex: 3;
        }
        .middle {
            display: flex;
            flex: 3;
        }
        .middle div{
            flex: 1;
        }
        .bottom {
            flex: 3;
            display: flex;
        }
        .top > div {
            flex: 1;
        }

        .bottom > div {
            flex: 1;
        }
    </style>
</head>
<body id="04_02" data-title="管理风险">
<div class="container">
    <h2 hidden>管理风险</h2>
    <header class="pageHeader">
        <div class="inputGroup">
            <label>平台：</label>
            <div class="mySelect" id="jingzhenglizhibiao4">
                <div class="myOption selected"><span class="text"></span><span class="icon"></span>
                </div>
                <ul id="jysinfo" class="myOptionBox">
                    ##for(j in jysinfolist!){
                    <li id="${j.jysc!}" data="${j.jysinfo!}" onclick=changeJysData(this) class="myOption" >${j.jysinfo!}</li>
                    ##}
                </ul>
            </div>
        </div>
    </header>
    <div class="top">
        <!--平台成交量和成交额-->
        <div class="top-l">
            <div class="chartBox ec001">
                <div class="chartTitle">
                    <h3>平台成交量和成交额</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec002_04_02currentCompetitiveness01"></div>
                    </div>
                </div>
            </div>
        </div>
        <!--平均满标用时-->
        <div class="top-r">
            <div class="chartBox ec003">
                <div class="chartTitle">
                    <h3>平均满标用时</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec002_04_02currentCompetitiveness02"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="top">
        <!--平台投资人数和借款人数趋势-->
        <div class="top-l">
            <div class="chartBox ec001">
                <div class="chartTitle">
                    <h3>平台投资人数和借款人数趋势</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec002_04_02currentCompetitiveness03"></div>
                    </div>
                </div>
            </div>
        </div>
        <!--投资金额借款金额区间人数-->
        <div class="top-r">
            <div class="chartBox ec003">
                <div class="chartTitle">
                    <h3>投资金额借款金额区间人数</h3>
                </div>

                <div class="chartContent">
                    <div class="btnGroup">
                        <button id='jkr'  class="active">借款人分级</button>
                        <button id='tzr'  >投资人分级</button>
                    </div>
                    <div class="chartBody">
                        <div id="ec002_04_02currentCompetitiveness04"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom">
        <!--人均投资金额和人均借款金额-->
        <div class="bottom_l">
            <div class="chartBox ec001">
                <div class="chartTitle">
                    <h3>人均投资金额和人均借款金额</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec002_04_02currentCompetitiveness05"></div>
                    </div>
                </div>
            </div>
        </div>
        <!--资金流入-->
        <div class="bottom_m">
            <div class="chartBox ec001">
                <div class="chartTitle">
                    <h3>资金流入</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec002_04_02currentCompetitiveness06"></div>
                    </div>
                </div>
            </div>
        </div>
        <!--待偿本金-->
        <div class="bottom_r">
            <div class="chartBox ec001">
                <div class="chartTitle">
                    <h3>待偿本金</h3>
                </div>
                <div class="chartContent">
                    <div class="chartBody">
                        <div id="ec002_04_02currentCompetitiveness07"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="${contextPath}/static/asserts/js/echarts-4.0.js"></script>
<script src="${contextPath}/static/asserts/js/jquery-2.2.4.js"></script>
<script src="${contextPath}/static/js/main.js"></script>
<script src="${contextPath}/static/js/chartsCom.js"></script>
<script>
    var allCharts = [];
    var myChart1 = echarts.init($("#ec002_04_02currentCompetitiveness01")[0]);
    var myChart2 = echarts.init($("#ec002_04_02currentCompetitiveness02")[0]);
    var myChart3 = echarts.init($("#ec002_04_02currentCompetitiveness03")[0]);
    var myChart4 = echarts.init($("#ec002_04_02currentCompetitiveness04")[0]);
    var myChart5 = echarts.init($("#ec002_04_02currentCompetitiveness05")[0]);
    var myChart6 = echarts.init($("#ec002_04_02currentCompetitiveness06")[0]);
    var myChart7 = echarts.init($("#ec002_04_02currentCompetitiveness07")[0]);
    $(function () {
        //模块一
        myChart1 = echarts.init($("#ec002_04_02currentCompetitiveness01")[0]);
        myChart1.setOption(opt_line);
        myChart1.setOption(opt_bar_vertical);

        //模块二
		myChart2 = echarts.init($("#ec002_04_02currentCompetitiveness02")[0]);
        myChart2.setOption(opt_bar_horizon);
        myChart2.setOption(opt_line);
        //模块三
        myChart3 = echarts.init($("#ec002_04_02currentCompetitiveness03")[0]);
        myChart3.setOption(opt_bar_horizon);
        myChart3.setOption(opt_line);

        //模块四
        myChart4 = echarts.init($("#ec002_04_02currentCompetitiveness04")[0]);
        myChart4.setOption(opt_bar_vertical);
        myChart4.setOption(opt_line);



        //模块五
        myChart5 = echarts.init($("#ec002_04_02currentCompetitiveness05")[0]);
        myChart5.setOption(opt_bar_horizon);
        myChart5.setOption(opt_line);
        //模块六
      	myChart6 = echarts.init($("#ec002_04_02currentCompetitiveness06")[0]);
        myChart6.setOption(opt_bar_vertical);
        myChart6.setOption(opt_line);


        //模块七
        myChart7 = echarts.init($("#ec002_04_02currentCompetitiveness07")[0]);
        myChart7.setOption(opt_bar_horizon);
        myChart7.setOption(opt_line);

        //本页所有图表
        allCharts = [myChart1, myChart2,myChart3,myChart4,myChart5,myChart6,myChart7];

    });
    
    
    	/* ljm */
    	//获取页面参数 交易市场名称jyscmc
		jysinfo=$("#jysinfo").find("li").eq(0).attr("data");
    	initData();
	    
    	function changeJysData(obj){
			//获取交易所现在下拉选择值
			jysinfo=$(obj).attr("data");
			initData();
		 }
		function initData(){
			getTotalTranNum();//交易总量，总额
			getAvgTime();//平均满标用时
			getCustNum();//投资人数 借款人数
			//getRangeNumber();//投资金额区间
			getLoanRangeNumber();//借款金额区间
			getLoanAndInvestNumber();//人均投资金额,人均借款金额
			getFlowAmount();//资金流入
			getCollectPrincipal();//代偿本金
			$("#jkr").click(function(){//点击事件  按借款人分级
				getLoanRangeNumber();
		  	});
			$("#tzr").click(function(){//点击事件  按投资人分级
				getRangeNumber();
		  	});
		}

		//借款金额区间人数
		function getLoanRangeNumber(){
			var ppType = $("#jkr").html().substr(0,3);
 			$.post("${contextPath}/qdch/deal/getLoanRangeNumber",{"jysinfo":jysinfo,"ppType":ppType},function(data){
 		    	var month=[];
 		    	var lines1=[];
 		    	console.log(data)
 				$.each(data,function(index,item){
 					var num=[];
	    			$.each(item.numlist,function(index2,item2){
	    				if(index==0){
	    					month.push(item2.vday_ym);
	    				}
	    					num.push(item2.jkrnum);
	    			});

	    			
	    			var ser1= {
	                        name:item.pp_range,
	                        type: 'bar',
	                        stack: '总量',
	                        barWidth:barWidth,
	                        data: num
	                };	
	    			
	    			lines1.push(ser1);
	    		});   
 		    	myChart4.clear();
 		        myChart4.setOption(opt_bar_vertical);
 		        myChart4.setOption(opt_line);
	            myChart4.setOption({
	                tooltip : {
	                    trigger: 'axis',
	                    axisPointer : {            
	                        type : 'line'        
	                    }
	                },
	                legend: {
	                    show:false
	                },
	                grid: {
	                    left: '7%',
	                    right: '5%',
	                    bottom: '22%',
	                    top: '5%'
	                },
	                xAxis:  {
	                    name:'月份',
	                    type: 'category',
	                    data: month
	                },
	                yAxis: {
	                    type: 'value'

	                },
	                series: lines1
	            });		
			}); 
		}
		//投资金额区间人数
		function getRangeNumber(){
			var ppType = $("#tzr").html().substr(0,3);

 			$.post("${contextPath}/qdch/deal/getRangeNumber",{"jysinfo":jysinfo,"ppType":ppType},function(data){
 		    	var month=[];
 		    	var lines=[];
 				$.each(data,function(index,item){
 					var num=[];
 					
	    			$.each(item.numlist,function(index2,item2){
	    				if(index==0){
	    					month.push(item2.vday_ym);
	    				}
	    					num.push(item2.tzrnum);
	    			});
	    			
	    			var ser= {
	                        name: item.pp_range,
	                        type: 'bar',
	                        stack: '总量',
	                        barWidth:barWidth,
	                        data: num
	                };	
	    			console.log(item.pp_range)
	    			lines.push(ser);
	    		}); 
 				myChart4.clear();
 		        myChart4.setOption(opt_bar_vertical);
 		        myChart4.setOption(opt_line);
	            myChart4.setOption({
	                tooltip : {
	                    trigger: 'axis',
	                    axisPointer : {            
	                        type : 'line'        
	                    }
	                },
	                legend: {
	                    show:false
	                },
	                grid: {
	                    left: '7%',
	                    right: '5%',
	                    bottom: '22%',
	                    top: '5%'
	                },
	                xAxis:  {
	                    name:'月份',
	                    type: 'category',
	                    data: month
	                },
	                yAxis: {
	                    type: 'value'

	                },
	                series: lines
	            });		
			}); 
		}
		//总成交量 总成交额
		function getTotalTranNum(){
		 	$.post("${contextPath}/qdch/deal/getTotalTranNum",{"jysinfo":jysinfo},function(data){
				var zcjlvalue=[];
		    	var zcjevalue=[];
		    	var month=[];
		    	var month1=[];
		    	
		    	//总成交量
	    		$.each(data.totalList,function(index,item){
	    			month.push(item.month);
	    			zcjlvalue.push(item.jyzlvalue);
		    		//总成交额
	    			$.each(data.countList,function(index1,item1){
	        			month1.push(item1.month);
	        			if(item.month==item1.month){
		    				zcjevalue.push(item1.jyzevalue);
	        			}
		    		});
	    		});

	

	    		
	            myChart1.setOption(opt_line);
	            myChart1.setOption(opt_bar_vertical);
	            myChart1.setOption({
	                grid: {
	                    left: '5%',
	                    right: '8%',
	                    bottom: '18%',
	                    top: '30%'
	                },
	                xAxis: [
	                    {
	                        name: '月份',
	                        type: 'category',
	                        data: month,
	                        nameGap: 18 * bodyScale
	                    }
	                ],
	                yAxis: [
	                    {
	                        type: 'value',
	                        name: '金额',
	                        nameGap: 4 * bodyScale
	                    },
	                    {
	                        type: 'value',
	                        name: '笔数',
	                        axisLine: { //坐标轴
	                            lineStyle: {
	                                color: "#369"
	                            }
	                        },
	                        splitLine: {
	                            lineStyle: {
	                                color: "#369"
	                            }
	                        }
	                    }
	                ],
	                series: [
	                    {
	                        name: '成交笔数',
	                        type: 'bar',
	                        data: zcjlvalue,
	                        barWidth: barWidth
	                    },
	                    {
	                        name: '成交金额',
	                        type: 'line',
	                        data: zcjevalue,
	                        symbol: 'circle',
	                        yAxisIndex: 1
	                    }
	                ]
	            });
			});
		}
		//平均满标用时
		function getAvgTime(){
		 	$.post("${contextPath}/qdch/deal/getAvgTime",{"jysinfo":jysinfo},function(data){
				var avgtime=[];
		    	var month=[];
		    	//总成交量
	    		$.each(data,function(index,item){
	    			month.push(item.month);
	    			avgtime.push(item.avgtime);
	    		});
	            myChart2.setOption(opt_bar_horizon);
	            myChart2.setOption(opt_line);
	            myChart2.setOption({
	                grid: {
	                    left: '15%',
	                    right: '5%',
	                    bottom: '25%',
	                    top: '20%'
	                },
	                legend:{
	                    show:false
	                },
	                xAxis: [
	                    {
	                        name: '月份',
	                        type: 'category',
	                        data: month,
	                        axisTick: {
	                            alignWithLabel: true
	                        }
	                    }
	                ],
	                yAxis: [
	                    {
	                        name: '时间',
	                        type: 'value'
	                    }
	                ],
	                series: [
	                    {
	                        name: '时间',
	                        type: 'line',
	                        data: avgtime,
	                        symbol: 'circle'
	                    }
	                ]
	            });		    	
		 	});
		}
		//人均借款，人均投资
		function getCustNum(){
		 	$.post("${contextPath}/qdch/deal/getCustNum",{"jysinfo":jysinfo},function(data){
				var rjjkvalue=[];
		    	var rjtzvalue=[];
		    	var month=[];
		    	//人均借款
	    		$.each(data.loanList,function(index,item){
	    			month.push(item.month);
	    			rjjkvalue.push(item.rjjkvalue);
	    		});
		    	//人均投资
	    		$.each(data.investList,function(index,item){
	    			rjtzvalue.push(item.rjtzvalue);
	    		});
	            myChart3.setOption(opt_bar_horizon);
	            myChart3.setOption(opt_line);
	            myChart3.setOption({
	                grid: {
	                    left: '5%',
	                    right: '5%',
	                    bottom: '18%',
	                    top: '20%'
	                },
	                xAxis: [
	                    {
	                        name: '月份',
	                        type: 'category',
	                        data: month,
	                        axisTick: {
	                            alignWithLabel: true
	                        }
	                    }
	                ],
	                yAxis: [
	                    {
	                        name: '人数',
	                        type: 'value'
	                    }
	                ],
	                series: [
	                    {
	                        name: '平台投资人数',
	                        type: 'line',
	                        data: rjtzvalue,
	                        symbol:'circle'
	                    },
	                    {
	                        name: '平台借款人数',
	                        type: 'line',
	                        data: rjjkvalue,
	                        symbol: 'circle'
	                    }
	                ]
	            });	    		
		 	});
		}
		//人均借款金额，人均投资金额
		function getLoanAndInvestNumber(){
		 	$.post("${contextPath}/qdch/deal/getLoanAndInvestNumber",{"jysinfo":jysinfo},function(data){
				var rjjkvalue=[];
		    	var rjtzvalue=[];
		    	var month=[];
		    	//人均借款金额
	    		$.each(data.loanList,function(index,item){
	    			month.push(item.month);
	    			rjjkvalue.push(item.rjjkvalue);
	    		});
		    	//人均投资金额
	    		$.each(data.investList,function(index,item){
	    			rjtzvalue.push(item.rjtzvalue);
	    		});
	            myChart5.setOption(opt_bar_horizon);
	            myChart5.setOption(opt_line);
	            myChart5.setOption({
	                grid: {
	                    left: '10%',
	                    right: '10%',
	                    bottom: '18%',
	                    top: '20%'
	                },
	                legend:{
	                    show:true
	                },
	                xAxis: [
	                    {
	                        name: '月份',
	                        type: 'category',
	                        data: month,
	                        axisTick: {
	                            alignWithLabel: true
	                        }
	                    }
	                ],
	                yAxis: [
	                    {
	                        name: '金额',
	                        type: 'value'
	                    }
	                ],
	                series: [
	                    {	
	                    	name:'人均投资',
	                        type: 'line',
	                        data: rjtzvalue,
	                        symbol: 'circle'
	                    },

	                    {	
	                    	name:'人均借款',
	                        type: 'line',
	                        data: rjjkvalue,
	                        symbol: 'circle'
	                    }
	                ]
	            });
		 	});
		}
		//资金流入
		function getFlowAmount(){
		 	$.post("${contextPath}/qdch/deal/getFlowAmount",{"jysinfo":jysinfo},function(data){
				var day=[];
		    	var fvalue=[];
		    	
	    		$.each(data,function(index,item){
	    			day.push(item.vday);
	    			fvalue.push(item.fvalue);
	    		});
	            myChart6.setOption(opt_bar_vertical);
	            myChart6.setOption(opt_line);
	            myChart6.setOption({
	                legend: {
	                    show:false
	                },
	                grid: {
	                    left: '20%',
	                    right: '10%',
	                    bottom: '15%',
	                    top:'20%' 
	                },
	                xAxis : [

	                    {
	                        type : 'category',
	                        axisTick : {show: false},
	                        data : day,
	                        name:'日期'
	                    }
	                ],
	                yAxis : [
	                    {   name:'金额',
	                        type : 'value'
	                    }
	                ],
	                series : [
	                    {
	                        name:'资金流入',
	                        type:'bar',
	                        stack: '总量',
	                        barWidth:barWidth,
	                        data:fvalue
	                    }
	                ]
	            });
		 	});
		}
		//代偿本金
		function getCollectPrincipal(){
		 	$.post("${contextPath}/qdch/deal/getCollectPrincipal",{"jysinfo":jysinfo},function(data){
				var bz=[];
		    	var day=[];
	    		$.each(data,function(index,item){
	    			bz.push(item.bz);
	    			day.push(item.vday_ym);
	    		});
	            myChart7.setOption(opt_bar_horizon);
	            myChart7.setOption(opt_line);
	            myChart7.setOption({
	                grid: {
	                    left: '20%',
	                    right: '10%',
	                    bottom: '15%',
	                    top: '20%'
	                },
	                legend:{
	                    show:false
	                },
	                xAxis: [
	                    {
	                        name: '月份',
	                        type: 'category',
	                        data: day,
	                        axisTick: {
	                            alignWithLabel: true
	                        }
	                    }
	                ],
	                yAxis: [
	                    {
	                        name: '金额',
	                        type: 'value'
	                    }
	                ],
	                series: [
	                    {
	                        type: 'line',
	                        data: bz,
	                        symbol: 'circle'
	                    }
	                ]
	            });

		 	});
		}


</script>
</body>
</html>

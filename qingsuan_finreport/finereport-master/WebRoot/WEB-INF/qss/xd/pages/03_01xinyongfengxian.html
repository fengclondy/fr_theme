<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="${contextPath}/static/img/com/logo.png">
    <link rel="stylesheet" href="${contextPath}/static/asserts/css/normalize.css">
    <link rel="stylesheet" href="${contextPath}/static/css/style.css">
    <link rel="stylesheet" href="${contextPath}/static/css/pageCom.css">
    <style>
        .bottom {
            flex: .5;
        }

        .top {
            flex: 3;
            display: flex;
        }

        .top-l {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .top-r {
            flex: 2;
            display: flex;
            flex-direction: column;
        }

        .right-top, .right-bottom {
            display: flex;
            flex: 1;
        }

        .right-top > div, .right-bottom > div {
            flex: 1;
        }
       /*  .myOptionBox{
			height:60px;
			overflow:auto;        
        } */
        
    </style>
</head>
<body id="03_01xinyongfengxian" data-title="信用风险">
<div class="container">
    <div class="top">
        <div class="top-l">
            <div class="trade-market">
                <header class="pageHeader">
                    <div class="inputGroup">
                        <label>筛选条件:</label>
                        <div class="mySelect" id="jingzhenglizhibiao">
                            <div class="myOption selected"><span class="text"></span><span class="icon"></span></div>
                            <ul class="myOptionBox" id="jysselect">
                               <!-- <li data="" class="myOption selected">全部</li> -->
                               ##for(j in jyslist!){
                                <li id="${j.jysc!}" onclick=changeJysData(this) class="myOption">${j.jyscmc!}</li>
                               ##}
                            </ul>
                        </div>
                    </div>
                </header>
            </div>
            <div class="chartBox ec001">
                <div class="chartTitle">
                    <h3>指标排名</h3>
                </div>
                <div class="chartContent">
                    <header>
                        <div class="btnGroup">
                            <button class="active" id="dkcs">贷款次数</button>
                            <button id="amount1">累计贷款额-个人</button>
                            <br>
                            <button id="amount2">累计贷款额-企业</button>
                            <button id="Yeamount2">贷款余额-企业</button>
                            <button id="Yeamount1">贷款余额-个人</button>
                        </div>
                    </header>
                    <div class="chartBody">
                        <div id="ec001"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="top-r">
            <div class="right-top">
                <div class="chartBox ec002">
                    <div class="chartTitle">
                        <h3>不良率</h3>
                    </div>
                    <div class="chartContent">
                        <header>
                            <div class="inputGroup">
                                <label>筛选条件:</label>
                                <div class="mySelect" >
                                    <div class="myOption selected"><span class="text"></span><span class="icon"></span>
                                    </div>
                                    <ul class="myOptionBox" id="defrate">
                                        <li class="myOption selected" data="dbfs">担保方式</li>
                                        <li class="myOption" data="dkqx">贷款期限</li>
                                        <li class="myOption" data="qyyt">贷款用途</li>
                                        <li class="myOption" data="qygm">企业规模</li>
                                        <li class="myOption" data="khjjnl">客户进件年龄</li>
                                    </ul>
                                </div>
                            </div>
                        </header>
                        <div class="chartBody">
                            <div id="ec002"></div>
                        </div>
                    </div>
                </div>
                <div class="chartBox ec003">
                    <div class="chartTitle">
                        <h3>迁徙率</h3>
                    </div>
                    <div class="chartContent">
                        <header>
                            <div class="inputGroup">
                                <label>筛选条件:</label>
                                <div class="mySelect" >
                                    <div class="myOption selected"><span class="text"></span><span class="icon"></span>
                                    </div>
                                    <ul class="myOptionBox" id="migrationrrate">
                                        <li class="myOption selected" data="m1">M1</li>
                                        <li class="myOption" data="m2">M2</li>
                                        <li class="myOption" data="m3">M3</li>
                                    </ul>
                                </div>
                            </div>
                        </header>
                        <div class="chartBody">
                            <div id="ec003"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-bottom">
                <div class="chartBox ec004">
                    <div class="chartTitle">
                        <h3>集中度</h3>
                    </div>
                    <div class="chartContent">
                        <header>
                            <div class="inputGroup">
                                <label>筛选条件:</label>
                                <div class="mySelect" id="jingzhenglizhibiao4">
                                    <div class="myOption selected"><span class="text"></span><span class="icon"></span>
                                    </div>
                                    <ul class="myOptionBox" >
                                        <li class="myOption selected" id="conratioByCustCount">开户人数集中度</li>
                                        <li class="myOption" id="conratioByTime">时间集中度</li>
                                        <li class="myOption" id="conratioByAge">年龄集中度</li>
                                        <li class="myOption" id="conratioByRegion">地域集中度</li>
                                        <li class="myOption" id="conratioByIndustry">行业集中度</li>
                                    </ul>
                                </div>
                            </div>
                        </header>
                        <div class="chartBody">
                            <div id="ec004_ConcentrationDegree"></div>
                        </div>
                    </div>
                </div>
                <div class="chartBox ec005">
                    <div class="chartTitle">
                        <h3>贷款收入与逾期贷款损失率</h3>
                    </div>
                    <div class="chartContent">
                        <div class="chartBody">
                            <div id="ec005"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom">
        <div class="chartBox ec002">
            <div class="chartTitle">
                <h3>管理风险列示</h3>
            </div>
            <div class="chartContent">
                <table>
                    <thead>
                    <tr>
                        <th>报警时间</th>
                        <th>预警指标</th>
                        <th>预警原因</th>
                        <th>平台名称</th>
                        <th>业务详述</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>20180307 11:28:01</td>
                        <td>信用风险</td>
                        <td>借款集中度</td>
                        <td>鲁金宝</td>
                        <td class="more"><a href=""> 查看</a></td>
                    </tr>
                    <tr>
                        <td>20180307 11:28:01</td>
                        <td>信用风险</td>
                        <td>借款集中度</td>
                        <td>鲁金宝</td>
                        <td class="more"><a href=""> 查看</a></td>
                    </tr>
                    <tr>
                        <td>20180307 11:28:01</td>
                        <td>信用风险</td>
                        <td>借款集中度</td>
                        <td>鲁金宝</td>
                        <td class="more"><a href=""> 查看</a></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="${contextPath}/static/asserts/js/echarts-4.0.js"></script>
<script src="${contextPath}/static/asserts/js/jquery-2.2.4.js"></script>
<script src="${contextPath}/static/js/main.js"></script>
<script src="${contextPath}/static/js/chartsCom.js"></script>
<script>
    var allCharts = [];
    var ec001 = echarts.init($("#ec001")[0]);
    

    var ec002 = echarts.init($("#ec002")[0]);
    var ec003 = echarts.init($("#ec003")[0]);
    var ec004 = echarts.init($("#ec004_ConcentrationDegree")[0]);
    var ec005 = echarts.init($("#ec005")[0]);
     $(function () {
    	ec001.setOption(opt_bar_horizon);
        ec002.setOption(opt_line);

        //热力图
       
        var data = [
            [[1600, 1500, 1700, '山东', 1990], [600, 500, 700, '江苏', 1990]],
            [[1200, 1100, 1300, '山东', 2015], [200, 100, 300, '江苏', 2015]]
        ];
        ec004.setOption(opt_scatter)
        
        
        ec005.setOption(opt_line);
        //本页所有图表
        allCharts = [ec001, ec002, ec003, ec004, ec005];

     
        $("#dbfs").click(function(){
        	$.post("/qdch/defrate/getByDBFS","dkcs",function(data){
        		console.log("--------",data)
        		result=data;
        	});
        	//console.log($(this)[0])
        })
        //获取不良率
       
        ////根据不同条件获取指标排名
        $("#dkcs").click(function(){
        	getRanking()
        })
         $("#amount1").click(function(){
        	 var custype="1";
        	 getRankByAmount(custype)
        })
        $("#amount2").click(function(){
        	 var custype="2";
        	 getRankByAmount(custype)
        })
        $("#Yeamount1").click(function(){
        	 var custype="1";
        	 getRankByYeamount(custype)
        })
        $("#Yeamount2").click(function(){
        	 var custype="2";
        	 getRankByYeamount(custype)
        })
        //根据不同条件获取迁徙率
        $("#migrationrrate .myOption").click(function(){
        	var condition=$(this).attr("data");
        	//var contion=$("#jingzhenglizhibiao3").val();
        	console.log("=========================",condition);
        	getMigrationRrate(condition);
        
        		
        })
        //根据不同条件获取不良率
        $("#defrate .myOption").click(function(){
        	var condition=$(this).attr("data");
        	console.log("=========================",condition);
        	getDefrate(condition);
        
        		
        })
        //获取开户人数集中度
         $("#conratioByCustCount").click(function(){
        	 conratioByCustCount();
        })
        //获取时间集中度
         $("#conratioByTime").click(function(){
        	 conratioByTime();
        })
        //获取年龄集中度
         $("#conratioByAge").click(function(){
        	 conratioByAge();
        })
        //获取地域集中度
         $("#conratioByRegion").click(function(){
        	 conratioByRegion();
        })
        //获取行业集中度
         $("#conratioByIndustry").click(function(){
        	 conratioByIndustry();
        })
        //getJysSelected();
        //初始化信用风险页面时默认加载所有相关模块数据
        jysCode=$("#jysselect").find("li").eq(0).attr("id");
        initData();
    });
	
     var jysCode;
	//切换交易所 刷新全部数据
	 function changeJysData(obj){
		//获取交易所现在下拉选择值
		jysCode=$(obj).attr("id");
		initData();
	 }
	function initData(){
		
		getRanking();
		getDefrate("dbfs")
        getMigrationRrate("m1");
		conratioByCustCount();
		getIncomeAndLoss();
	}
      //根据贷款次数查询指数排名
   	 function getRanking(){
       	 $.post("${contextPath}/qdch/creditrisk/getRankByLoanCount",{"jys":jysCode},function(data){
       		
       		console.log("--------",jysCode)
        		result=data;  
        		var yAxisData=[];
        		var seriesData=[];
        		$.each(data,function(index,item){
        			var name="";
        			var page=parseInt(item.jyscmc.length/6);
        			if(item.jyscmc.length%6>0){
        				page++;
        			}
        			for(var x=1;x<parseInt(page)+1;x++){
        				name+=item.jyscmc.substr((x-1)*6,6)+"\n";
        			}
        			yAxisData.push(name);
        			seriesData.push(item.sum);
        		});
        		ec001.setOption({
                    grid: {
                        left: "26%",
                        right: "16%",
                        top: "15%"
                    },
                    xAxis: {
                        type: 'value',
                        name: '次数'
                    },
                    yAxis: {
                        name: '市场',
                       data:yAxisData
                    },
                    series: [{
                        data: seriesData,
                        type: 'bar',
                        barWidth: "20%"
                    }]
                }); 
        	});
       }
       //根据累计贷款额查询指数排名
       function getRankByAmount(custype){
         	 $.post("${contextPath}/qdch/creditrisk/getRankByLoanAmount",{"jys":jysCode,"custype":custype},function(data){
          		var yAxisData=[];
          		var seriesData=[];
          		$.each(data,function(index,item){
          			var name="";
          			var page=parseInt(item.name.length/6);
          			if(item.name.length%6>0){
          				page++;
          			}
          			var preName=item.name;
          			for(var x=1;x<parseInt(page)+1;x++){
          				console.log(preName.substr((x-1)*3,6)+"\n")
          				name+=preName.substr((x-1)*6,6)+"\n";
          			}
          			yAxisData.push(name);
          			seriesData.push(item.value);
          		});
          		ec001.setOption({
                      grid: {
                          left: "26%",
                          right: "16%",
                          top: "15%"
                      },
                      xAxis: {
                          type: 'value',
                          name: '万元'
                      },
                      yAxis: {
                          name: '市场',
                         data:yAxisData
                      },
                      series: [{
                          data: seriesData,
                          type: 'bar',
                          barWidth: "20%"
                      }]
                  }); 
          	});
         }
       //根据贷款余额查询指数排名
       function getRankByYeamount(custype){
         	 $.post("${contextPath}/qdch/creditrisk/getRankByYeamount",{"jys":jysCode,"custype":custype},function(data){
         		console.log("--------",data)
          		var yAxisData=[];
          		var seriesData=[];
          		$.each(data,function(index,item){
          			var name="";
          			var page=parseInt(item.name.length/6);
          			if(item.name.length%6>0){
          				page++;
          			}
          			for(var x=1;x<parseInt(page)+1;x++){
          				name+=item.name.substr((x-1)*6,6)+"\n";
          			}
          			yAxisData.push(name);
          			seriesData.push(item.value);
          		});
          		ec001.setOption({
                      grid: {
                          left: "26%",
                          right: "16%",
                          top: "15%"
                      },
                      xAxis: {
                          type: 'value',
                          name: '万元'
                      },
                      yAxis: {
                          name: '市场',
                         data:yAxisData
                      },
                      series: [{
                          data: seriesData,
                          type: 'bar',
                          barWidth: "20%"
                      }]
                  }); 
          	});
         } 
       function getMigrationRrate(condition){
       	 $.post("${contextPath}/qdch/creditrisk/getMigrationRrate",{"jys":jysCode,"condition":condition},function(data){
       		console.log("--------",data)
        		var yAxisData=[];
        		var seriesData=[];
        		$.each(data,function(index,item){
	        		yAxisData.push(item.name);
	    			seriesData.push(item.value);
       	 		});
        		ec003.setOption(opt_line);
        	    ec003.setOption({
        	    	  tooltip:{
        	    		  /* trigger: 'item', */
        	             formatter: function (params,ticket,callback) {
				            console.log(params)
				            var res =  params[0].name;
				            for (var i = 0, l = params.length; i < l; i++) {
				                res += '<br/>' + params[i].seriesName + ' : ' + params[i].value+"%";
				            }
				          
				            return res;
				        }

        	            },
        	            grid: {
        	                top: "24%",
        	                right:'16%',
        	                bottom: '30%'
        	            },
        	            legend: {
        	                show: false
        	            },
        	            xAxis: {
        	                name: '月份',
        	                data: yAxisData
        	            },
        	            yAxis: {
        	                name: '迁徙率(%)',
        	            },
        	            series: [
        	                {
        	                    name: '迁徙率',
        	                    type: 'line',
        	                    symbol: 'circle',
        	                    data: seriesData,
        	                    areaStyle: lineAreaStyle(0)
        	                }
        	            ]

        	        });
        		
        		
        		
        	});
       } 
       //获取不良率
       function getDefrate(condition){
	        $.post("${contextPath}/qdch/creditrisk/getDefrateByCondition",{"jys":jysCode,"condition":condition},function(data){				    		
	    		var yAxisData=[];
        		var seriesData=[];
        		var con=[];
        		$.each(data,function(index,item){
	        		var points=[];
        			$.each(item.data,function(ind,it){
        				if(index==1){
        					yAxisData.push(it.month);
        				}
        				points.push(it.value);
        				
        			});
        			con.push(item.condition);
        			var  ser={
    	                    name: item.condition,
    	                    type: 'line',
    	                    symbol: 'circle',
    	                    data: points,
    	                    areaStyle: lineAreaStyle(index)

    	                };
	        		//yAxisData.push(item.month);
	    			seriesData.push(ser);
	    			
       	 		});
        		 ec002.setOption({
        			 tooltip:{
       	    		  /* trigger: 'item', */
       	             formatter: function (params,ticket,callback) {
				            console.log(params)
				            var res =  params[0].name;
				            for (var i = 0, l = params.length; i < l; i++) {
				                res += '<br/>' + params[i].seriesName + ' : ' + params[i].value+"%";
				            }
				          
				            return res;
				        }

       	            },
        	            grid: {
        	                top: "24%",
        	                right:'16%',
        	                bottom: '30%'
        	            },
        	            legend: {
        	                show: false
        	            },
        	            xAxis: {
        	                name: '月份',
        	                data: yAxisData
        	            },
        	            yAxis: {
        	                name: '不良率(%)',
        	            },
        	            series: seriesData,
        	        }); 
	    	});
       }
       //获取开户人数集中度
       function conratioByCustCount(){
         	 $.post("${contextPath}/qdch/creditrisk/getConRatioByCustCount",{"jys":jysCode},function(data){
         		console.log("---集中度-----",data)
          		var yAxisData=[];
          		var seriesData=[];
          		$.each(data,function(index,item){
  	        		yAxisData.push(item.month);
  	    			seriesData.push(item.value);
  	    			
         	 		});
          		 ec004.setOption(opt_scatter)
                 ec004.setOption(
                     {
                    	 tooltip:{
              	    		  /* trigger: 'item', */
              	             formatter: function (params,ticket,callback) {
       				            console.log(params)
       				            var res =  params[0].name;
       				            for (var i = 0, l = params.length; i < l; i++) {
       				                res += '<br/>' + params[i].seriesName + ' : ' + params[i].value+"%";
       				            }
       				          
       				            return res;
       				        }

              	            },
                         grid: {
                             top: "24%",
                             right:'16%',
                             bottom: '30%'
                         },
                         legend: {
                             show: false
                         },
                         xAxis: {
                             name: '月份',
                             data: yAxisData,
                         },
                         yAxis: {
                             name: '集中度(%)',
                         },
                         series: [
                             {
                                 name: '集中度',
                                 type: 'line',
                                 symbol: 'circle',
                                 data: seriesData,
                                 areaStyle: lineAreaStyle(0)
                             }
                         ]
                     });
          		
          		
          	});
         } 
       //获取时间集中度
       function conratioByTime(){
       	 $.post("${contextPath}/qdch/creditrisk/getConRatioByTime",{"jys":jysCode},function(data){
       		console.log("---集中度-----",data)
        		var yAxisData=[];
        		var seriesData=[];
        		$.each(data,function(index,item){
	        		yAxisData.push(item.month);
	    			seriesData.push(item.value);
	    			
       	 		});
        		console.log("---书坐标-----",seriesData)
        		console.log("---月份坐标-----",yAxisData)
        		 ec004.setOption(opt_scatter)
               ec004.setOption(
                   {
                	   
                       grid: {
                           top: "24%",
                           right:'16%',
                           bottom: '30%'
                       },
                       legend: {
                           show: false
                       },
                       xAxis: {
                           name: '月份',
                           data: yAxisData,
                       },
                       yAxis: {
                           name: '集中度(%)',
                       },
                       series: [
                           {
                               name: '集中度',
                               type: 'line',
                               symbol: 'circle',
                               data: seriesData,
                               areaStyle: lineAreaStyle(0)
                           }
                       ]
                   });
        		
        		
        	});
       } 
       //获取年龄集中度
       function conratioByAge(){
         	 $.post("${contextPath}/qdch/creditrisk/getConRatioByAge",{"jys":jysCode},function(data){
         		console.log("---集中度-----",data)
          		var yAxisData=[];
          		var seriesData=[];
          		$.each(data,function(index,item){
  	        		yAxisData.push(item.agestage);
  	    			seriesData.push(item.nums);
  	    			
         	 		});
          		console.log("---书坐标-----",seriesData)
          		console.log("---月份坐标-----",yAxisData)
          		 ec004.setOption(opt_scatter)
                 ec004.setOption(
                     {
                    	 
                         grid: {
                             top: "24%",
                             right:'16%',
                             bottom: '30%'
                         },
                         legend: {
                             show: false
                         },
                         xAxis: {
                             name: '年龄段',
                             data: yAxisData,
                         },
                         yAxis: {
                             name: '集中度(%)',
                         },
                         series: [
                             {
                                 name: '集中度',
                                 type: 'line',
                                 symbol: 'circle',
                                 data: seriesData,
                                 areaStyle: lineAreaStyle(0)
                             }
                         ]
                     });
          		
          		
          	});
         } 
       //获取地域集中度
       function conratioByRegion(){
       	 $.post("${contextPath}/qdch/creditrisk/getConRatioByRegion",{"jys":jysCode},function(data){
       		console.log("---集中度-----",data)
        		var yAxisData=[];
        		var seriesData=[];
        		$.each(data,function(index,item){
	        		yAxisData.push(item.provice);
	    			seriesData.push(item.nums);
	    			
       	 		});
        		console.log("---书坐标-----",seriesData)
        		console.log("---月份坐标-----",yAxisData)
        		 ec004.setOption(opt_scatter)
               ec004.setOption(
                   {
                	   
                       grid: {
                           top: "24%",
                           right:'16%',
                           bottom: '30%'
                       },
                       legend: {
                           show: false
                       },
                       xAxis: {
                           name: '地域',
                           data: yAxisData,
                       },
                       yAxis: {
                           name: '集中度(%)',
                       },
                       series: [
                           {
                               name: '集中度',
                               type: 'line',
                               symbol: 'circle',
                               data: seriesData,
                               areaStyle: lineAreaStyle(0)
                           }
                       ]
                   });
        		
        		
        	});
       } 
       //获取行业集中度
       function conratioByIndustry(){
         	 $.post("${contextPath}/qdch/creditrisk/getConRatioByIndustry",{"jys":jysCode},function(data){
         		console.log("---集中度-----",data)
          		var yAxisData=[];
          		var seriesData=[];
          		$.each(data,function(index,item){
  	        		yAxisData.push(item.waykind);
  	    			seriesData.push(item.nums);
  	    			
         	 		});
          		console.log("---书坐标-----",seriesData)
          		console.log("---月份坐标-----",yAxisData)
          		 ec004.setOption(opt_scatter)
                 ec004.setOption(
                     {
                    	  
                         grid: {
                             top: "24%",
                             right:'16%',
                             bottom: '30%'
                         },
                         legend: {
                             show: false
                         },
                         xAxis: {
                             name: '月份',
                             data: yAxisData,
                         },
                         yAxis: {
                             name: '集中度(%)',
                         },
                         series: [
                             {
                                 name: '集中度',
                                 type: 'line',
                                 symbol: 'circle',
                                 data: seriesData,
                                 areaStyle: lineAreaStyle(0)
                             }
                         ]
                     });
          		
          		
          	});
         } 
     //获取贷款收入和损失率
       function getIncomeAndLoss(){
	        $.post("${contextPath}/qdch/creditrisk/getIncomeAndLoss",{"jys":jysCode},function(data){
	    							    		
	    		var yAxisData=[];
        		var seriesData1=[];
        		var seriesData2=[];
        		$.each(data,function(index,item){
        			
        			yAxisData.push(item.month);
        			if(item.value1==undefined){
        				seriesData1.push(0);
        			}else{
        				seriesData1.push(item.value1);
        			}
        			if(item.value2==undefined){
        				seriesData2.push(0);
        			}else{
        				seriesData2.push(item.value2);
        			}
        			
	    			
       	 		});
        		
        		  ec005.setOption({
        			  tooltip:{
          	    		  /* trigger: 'item', */
          	             formatter: function (params,ticket,callback) {
   				            console.log(params)
   				            var res =  params[0].name;
   				            for (var i = 0, l = params.length; i < l; i++) {
   				                res += '<br/>' + params[i].seriesName + ' : ' + params[i].value+"%";
   				            }
   				          
   				            return res;
   				        }

          	            },
        	            grid: {
        	                top: "25%",
        	                right:'16%',
        	                bottom:"20%"
        	            },
        	            legend: {
        	                show: false
        	            },
        	            xAxis: {
        	                name: '月份',
        	                data:yAxisData
        	            },
        	            yAxis: {
        	                name: '损失率(%)',
        	            },
        	            series: [{
        	                    name: '贷款收入',
        	                    type: 'line',
        	                    symbol: 'circle',
        	                    data: seriesData1,
        	                    areaStyle: lineAreaStyle(0)
        	                },
        	                {
        	                    name: '逾期贷款损失率',
        	                    type: 'line',
        	                    symbol: 'circle',
        	                    data: seriesData2,
        	                    areaStyle: lineAreaStyle(1)
        	                }
        	            ]
        	        });
        		
        		
        	
	    	});
       }
</script>
</body>
</html>
